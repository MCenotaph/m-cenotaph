<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>M. CENOTAPH — AUTHORIZED ACCESS TERMINAL</title>
  <meta name="description" content="Digital archive. Restricted access. Proceed with authorization." />
  <meta property="og:title" content="M. CENOTAPH" />
  <meta property="og:description" content="Archive Status: RECOVERED. Access Level: CONDITIONAL." />
  <meta property="og:image" content="og-preview.jpg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,300;1,400&family=IBM+Plex+Serif:ital,wght@0,200;0,300;1,200;1,300&display=swap" rel="stylesheet" />

  <style>
    /* ============================================================
       TOKENS & RESET
    ============================================================ */
    :root {
      --black:       #020204;
      --void:        #07070b;
      --surface:     #0d0d14;
      --border:      #26263a;
      --border-soft: #1c1c2a;
      --dim:         #58587a;
      --muted:       #7878a0;
      --ghost:       #9898c0;
      --ash:         #bcbcd8;
      --silver:      #d8d8f0;
      --bone:        #eaeaf8;
      --white:       #f4f4fc;
      --accent:      #c8c8ff;
      --accent-hot:  #a0a0ff;
      --danger:      #ff5555;
      --gold:        #d4b46e;
      --gold-dim:    #9a7840;

      --font-mono:   'IBM Plex Mono', 'Courier New', monospace;
      --font-serif:  'IBM Plex Serif', Georgia, serif;

      --gutter: clamp(1.5rem, 5vw, 4rem);
      --col-max: 1100px;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 14px;
      scroll-behavior: smooth;
    }

    body {
      background-color: var(--black);
      color: var(--silver);
      font-family: var(--font-mono);
      font-weight: 300;
      line-height: 1.7;
      overflow-x: hidden;
      cursor: crosshair;
    }

    ::selection {
      background: var(--accent);
      color: var(--black);
    }

    /* ============================================================
       NOISE OVERLAY
    ============================================================ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 9998;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
      background-size: 128px 128px;
      opacity: 0.028;
      mix-blend-mode: overlay;
      animation: noiseShift 0.15s steps(2) infinite;
    }

    @keyframes noiseShift {
      0%   { background-position: 0 0; }
      25%  { background-position: 30px -15px; }
      50%  { background-position: -20px 10px; }
      75%  { background-position: 15px 25px; }
      100% { background-position: 0 0; }
    }

    /* Scanlines */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 9997;
      pointer-events: none;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0,0,0,0.06) 2px,
        rgba(0,0,0,0.06) 4px
      );
    }

    /* ============================================================
       BOOT SCREEN / ACCESS GATE
    ============================================================ */
    #boot-screen {
      position: fixed;
      inset: 0;
      z-index: 9000;
      background: var(--black);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 0;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }

    #boot-screen.dismissed {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .boot-log {
      width: min(640px, 90vw);
      font-size: 0.78rem;
      color: var(--ghost);
      letter-spacing: 0.04em;
    }

    .boot-line {
      display: block;
      opacity: 0;
      white-space: nowrap;
      overflow: hidden;
      border-right: 1px solid transparent;
    }

    .boot-line.visible {
      opacity: 1;
    }

    .boot-line.typing {
      border-right-color: var(--accent);
      animation: blink-cursor 0.6s step-end infinite;
    }

    @keyframes blink-cursor {
      0%, 100% { border-right-color: var(--accent); }
      50%       { border-right-color: transparent; }
    }

    .boot-line .ok   { color: var(--accent-hot); }
    .boot-line .warn { color: var(--gold); }
    .boot-line .err  { color: var(--danger); }
    .boot-line .dim  { color: var(--dim); }

    .boot-separator {
      border: none;
      border-top: 1px solid var(--border);
      margin: 2rem 0;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .boot-separator.visible { opacity: 1; }

    #proceed-btn {
      margin-top: 2.5rem;
      opacity: 0;
      background: none;
      border: 1px solid var(--border);
      color: var(--silver);
      font-family: var(--font-mono);
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      padding: 0.8rem 2.4rem;
      cursor: pointer;
      text-transform: uppercase;
      transition: border-color 0.3s, color 0.3s, background 0.3s;
      position: relative;
    }

    #proceed-btn::before,
    #proceed-btn::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 6px;
      border-color: var(--accent);
      border-style: solid;
      transition: all 0.3s ease;
    }

    #proceed-btn::before {
      top: -1px; left: -1px;
      border-width: 1px 0 0 1px;
    }

    #proceed-btn::after {
      bottom: -1px; right: -1px;
      border-width: 0 1px 1px 0;
    }

    #proceed-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(160,160,255,0.04);
    }

    #proceed-btn.visible {
      opacity: 1;
      animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ============================================================
       MAIN LAYOUT
    ============================================================ */
    #main-content {
      opacity: 0;
      transition: opacity 1.2s ease;
    }

    #main-content.visible { opacity: 1; }

    /* ============================================================
       HEADER / NAV
    ============================================================ */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      border-bottom: 1px solid var(--border-soft);
      background: rgba(2,2,4,0.92);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .header-inner {
      max-width: var(--col-max);
      margin: 0 auto;
      padding: 0 var(--gutter);
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .wordmark {
      font-size: 0.72rem;
      letter-spacing: 0.28em;
      font-weight: 500;
      color: var(--white);
      text-decoration: none;
      text-transform: uppercase;
      position: relative;
    }

    .wordmark::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--accent);
      transition: width 0.4s ease;
    }

    .wordmark:hover::after { width: 100%; }

    .header-status {
      font-size: 0.6rem;
      color: var(--ghost);
      letter-spacing: 0.12em;
    }

    .header-status .dot {
      display: inline-block;
      width: 5px;
      height: 5px;
      background: var(--accent-hot);
      border-radius: 50%;
      margin-right: 0.5rem;
      animation: pulse-dot 2s ease-in-out infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; transform: scale(1); }
      50%       { opacity: 0.3; transform: scale(0.7); }
    }

    nav {
      display: flex;
      align-items: center;
      gap: 0;
    }

    .nav-link {
      font-size: 0.6rem;
      letter-spacing: 0.15em;
      color: var(--ghost);
      text-decoration: none;
      text-transform: uppercase;
      padding: 0.4rem 1rem;
      border-left: 1px solid var(--border-soft);
      transition: color 0.2s, background 0.2s;
      position: relative;
    }

    .nav-link:first-child { border-left: none; }

    .nav-link:hover {
      color: var(--silver);
      background: rgba(255,255,255,0.02);
    }

    .nav-link[data-locked]::after {
      content: '⌇';
      margin-left: 0.4rem;
      color: var(--gold-dim);
      font-size: 0.55rem;
    }

    /* ============================================================
       HERO
    ============================================================ */
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      padding: 120px var(--gutter) 80px;
      max-width: var(--col-max);
      margin: 0 auto;
      position: relative;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 4rem;
      align-items: end;
      width: 100%;
    }

    .hero-left {}

    .hero-prefix {
      font-size: 0.6rem;
      letter-spacing: 0.3em;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 2.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .hero-prefix::before {
      content: '';
      display: block;
      width: 40px;
      height: 1px;
      background: var(--muted);
    }

    .hero-title {
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: clamp(3rem, 8vw, 7rem);
      line-height: 0.92;
      color: var(--white);
      letter-spacing: -0.02em;
      margin-bottom: 0.2em;
      position: relative;
    }

    .hero-title .m-prefix {
      font-family: var(--font-mono);
      font-weight: 100;
      font-style: normal;
      font-size: 0.5em;
      letter-spacing: 0.1em;
      color: var(--ghost);
      display: block;
      margin-bottom: 0.3em;
    }

    /* Glitch on title */
    .hero-title .glitch {
      position: relative;
      display: inline-block;
    }

    .hero-title .glitch::before,
    .hero-title .glitch::after {
      content: attr(data-text);
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      font-family: inherit;
      font-weight: inherit;
      font-style: inherit;
      font-size: inherit;
      color: inherit;
    }

    .hero-title .glitch::before {
      color: var(--accent-hot);
      animation: glitch-before 8s infinite;
      clip-path: polygon(0 0, 100% 0, 100% 35%, 0 35%);
    }

    .hero-title .glitch::after {
      color: var(--gold);
      animation: glitch-after 8s infinite;
      clip-path: polygon(0 65%, 100% 65%, 100% 100%, 0 100%);
    }

    @keyframes glitch-before {
      0%, 90%, 100%   { transform: translate(0); opacity: 0; }
      91%              { transform: translate(-3px, 1px); opacity: 0.7; }
      92%              { transform: translate(3px, -1px); opacity: 0.7; }
      93%              { transform: translate(0); opacity: 0; }
      96%              { transform: translate(-2px, 0); opacity: 0.5; }
      97%              { transform: translate(0); opacity: 0; }
    }

    @keyframes glitch-after {
      0%, 90%, 100%   { transform: translate(0); opacity: 0; }
      91%              { transform: translate(3px, 2px); opacity: 0.6; }
      92%              { transform: translate(-2px, -1px); opacity: 0.6; }
      93%              { transform: translate(0); opacity: 0; }
    }

    .hero-subtitle {
      font-size: 0.72rem;
      color: var(--ghost);
      letter-spacing: 0.06em;
      margin-top: 2rem;
      max-width: 480px;
      line-height: 1.9;
    }

    .hero-subtitle em {
      font-style: normal;
      color: var(--ash);
    }

    .hero-cta-row {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-top: 3.5rem;
    }

    .btn-primary {
      background: none;
      border: 1px solid var(--silver);
      color: var(--white);
      font-family: var(--font-mono);
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      padding: 0.9rem 2rem;
      text-decoration: none;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.7rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .btn-primary::before,
    .btn-primary::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      transition: all 0.3s ease;
    }

    .btn-primary::before {
      top: -1px; left: -1px;
      border-top: 1px solid var(--accent);
      border-left: 1px solid var(--accent);
    }

    .btn-primary::after {
      bottom: -1px; right: -1px;
      border-bottom: 1px solid var(--accent);
      border-right: 1px solid var(--accent);
    }

    .btn-primary:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(160,160,255,0.04);
      letter-spacing: 0.26em;
    }

    .btn-ghost {
      font-size: 0.6rem;
      letter-spacing: 0.18em;
      color: var(--muted);
      text-decoration: none;
      text-transform: uppercase;
      padding-bottom: 2px;
      border-bottom: 1px solid var(--border);
      transition: color 0.2s, border-color 0.2s;
    }

    .btn-ghost:hover {
      color: var(--ghost);
      border-color: var(--ghost);
    }

    /* Right column: data panel */
    .hero-panel {
      width: 220px;
      border: 1px solid var(--border-soft);
      padding: 1.6rem;
      font-size: 0.58rem;
      color: var(--dim);
      letter-spacing: 0.08em;
      position: relative;
      background: rgba(13,13,18,0.6);
    }

    .hero-panel::before {
      content: 'SYS_STATUS';
      position: absolute;
      top: -0.55em;
      left: 1rem;
      background: var(--black);
      padding: 0 0.5rem;
      color: var(--muted);
      font-size: 0.55rem;
      letter-spacing: 0.2em;
    }

    .panel-row {
      display: flex;
      justify-content: space-between;
      padding: 0.45rem 0;
      border-bottom: 1px solid var(--border-soft);
      gap: 1rem;
    }

    .panel-row:last-child { border-bottom: none; }

    .panel-label { color: var(--muted); }
    .panel-val   { color: var(--ash); text-align: right; }
    .panel-val.live { color: var(--accent-hot); }
    .panel-val.locked { color: var(--gold-dim); }

    /* ============================================================
       SECTION COMMONS
    ============================================================ */
    section {
      max-width: var(--col-max);
      margin: 0 auto;
      padding: 6rem var(--gutter);
      position: relative;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      gap: 1.5rem;
      margin-bottom: 3.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-soft);
    }

    .section-code {
      font-size: 0.58rem;
      letter-spacing: 0.2em;
      color: var(--muted);
      text-transform: uppercase;
    }

    .section-title {
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: 1.6rem;
      color: var(--bone);
      letter-spacing: 0.01em;
    }

    .section-rule {
      flex: 1;
      height: 1px;
      background: var(--border-soft);
    }

    /* ============================================================
       ARCHIVE FILES (FILE_001 etc.)
    ============================================================ */
    .archive-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1px;
      background: var(--border-soft);
      border: 1px solid var(--border-soft);
    }

    .archive-item {
      background: var(--void);
      padding: 2.2rem;
      text-decoration: none;
      color: inherit;
      position: relative;
      overflow: hidden;
      transition: background 0.3s ease;
      cursor: pointer;
    }

    .archive-item::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(160,160,255,0.03) 0%, transparent 60%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .archive-item:hover { background: var(--surface); }
    .archive-item:hover::before { opacity: 1; }

    .archive-item.locked {
      cursor: not-allowed;
    }

    .archive-item.locked:hover { background: var(--void); }
    .archive-item.locked:hover::before { opacity: 0; }

    .file-tag {
      font-size: 0.55rem;
      letter-spacing: 0.25em;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .file-tag .status-badge {
      font-size: 0.5rem;
      padding: 0.2rem 0.5rem;
      border: 1px solid;
      letter-spacing: 0.15em;
    }

    .status-badge.active {
      color: var(--accent-hot);
      border-color: rgba(160,160,255,0.3);
    }

    .status-badge.restricted {
      color: var(--gold);
      border-color: rgba(200,169,110,0.3);
    }

    .status-badge.classified {
      color: var(--danger);
      border-color: rgba(255,68,68,0.3);
    }

    .file-name {
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: 1.3rem;
      color: var(--bone);
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .file-desc {
      font-size: 0.62rem;
      color: var(--ghost);
      line-height: 1.8;
      margin-bottom: 1.8rem;
    }

    .file-meta {
      font-size: 0.55rem;
      color: var(--dim);
      letter-spacing: 0.08em;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .file-meta span { display: flex; justify-content: space-between; }
    .file-meta .val { color: var(--muted); }

    .file-access-bar {
      margin-top: 1.6rem;
      height: 1px;
      background: var(--border-soft);
      position: relative;
      overflow: hidden;
    }

    .archive-item:not(.locked) .file-access-bar::after {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--accent-hot), transparent);
      animation: scan-line 4s linear infinite;
    }

    @keyframes scan-line {
      0%   { left: -100%; }
      100% { left: 100%; }
    }

    .lock-overlay {
      position: absolute;
      bottom: 1.4rem;
      right: 1.6rem;
      font-size: 0.55rem;
      letter-spacing: 0.2em;
      color: var(--gold-dim);
      text-transform: uppercase;
    }

    /* ============================================================
       THE VAULT SECTION
    ============================================================ */
    .vault-section {
      border-top: 1px solid var(--border-soft);
      border-bottom: 1px solid var(--border-soft);
      background: var(--void);
      padding: 6rem var(--gutter);
    }

    .vault-inner {
      max-width: var(--col-max);
      margin: 0 auto;
    }

    .vault-terminal {
      border: 1px solid var(--border);
      max-width: 620px;
      background: var(--black);
      position: relative;
    }

    .vault-terminal::before {
      content: 'SECURE VAULT — AUTHENTICATION REQUIRED';
      display: block;
      background: var(--border-soft);
      padding: 0.6rem 1.2rem;
      font-size: 0.55rem;
      letter-spacing: 0.2em;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
    }

    .vault-body {
      padding: 2.4rem;
    }

    .vault-desc {
      font-size: 0.63rem;
      color: var(--ghost);
      line-height: 1.9;
      margin-bottom: 2.5rem;
    }

    .vault-desc strong {
      color: var(--ash);
      font-weight: 400;
    }

    .vault-input-group {
      display: flex;
      gap: 0;
      border: 1px solid var(--border);
      transition: border-color 0.3s ease;
    }

    .vault-input-group:focus-within {
      border-color: var(--accent);
    }

    .vault-input-group.error {
      border-color: var(--danger);
      animation: shake 0.4s ease;
    }

    .vault-input-group.success {
      border-color: var(--accent-hot);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%       { transform: translateX(-6px); }
      40%       { transform: translateX(6px); }
      60%       { transform: translateX(-4px); }
      80%       { transform: translateX(4px); }
    }

    .vault-prefix {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 0 1rem;
      font-size: 0.6rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      letter-spacing: 0.1em;
      white-space: nowrap;
    }

    #vault-key {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      color: var(--white);
      padding: 0.9rem 1rem;
      text-transform: uppercase;
    }

    #vault-key::placeholder {
      color: var(--dim);
      letter-spacing: 0.1em;
    }

    #vault-submit {
      background: none;
      border: none;
      border-left: 1px solid var(--border);
      padding: 0 1.4rem;
      font-family: var(--font-mono);
      font-size: 0.58rem;
      letter-spacing: 0.18em;
      color: var(--ghost);
      text-transform: uppercase;
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
    }

    #vault-submit:hover {
      color: var(--accent);
      background: rgba(160,160,255,0.05);
    }

    #vault-response {
      margin-top: 1rem;
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      color: var(--dim);
      min-height: 1.4em;
      transition: color 0.3s;
    }

    #vault-response.err  { color: var(--danger); }
    #vault-response.ok   { color: var(--accent-hot); }

    .vault-hint {
      margin-top: 2rem;
      padding-top: 1.6rem;
      border-top: 1px solid var(--border-soft);
      font-size: 0.55rem;
      color: var(--dim);
      letter-spacing: 0.1em;
      line-height: 2;
    }

    .vault-hint .clue {
      color: var(--gold-dim);
      border-bottom: 1px dashed var(--gold-dim);
      cursor: help;
    }

    /* ============================================================
       MANIFESTO STRIP
    ============================================================ */
    .manifesto-strip {
      border-top: 1px solid var(--border-soft);
      overflow: hidden;
      background: var(--void);
    }

    .manifesto-ticker {
      display: flex;
      gap: 0;
      animation: ticker 40s linear infinite;
      white-space: nowrap;
      padding: 1rem 0;
    }

    .manifesto-ticker:hover { animation-play-state: paused; }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 2rem;
      padding: 0 3rem;
      font-size: 0.58rem;
      letter-spacing: 0.2em;
      color: var(--muted);
      text-transform: uppercase;
    }

    .ticker-item::after {
      content: '◆';
      color: var(--border);
      font-size: 0.4rem;
    }

    @keyframes ticker {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* ============================================================
       FOOTER
    ============================================================ */
    footer {
      border-top: 1px solid var(--border-soft);
      padding: 2.5rem var(--gutter);
      max-width: var(--col-max);
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
      flex-wrap: wrap;
    }

    .footer-left {
      font-size: 0.55rem;
      color: var(--dim);
      letter-spacing: 0.1em;
      line-height: 2;
    }

    .footer-right {
      font-size: 0.55rem;
      color: var(--dim);
      letter-spacing: 0.1em;
      text-align: right;
      line-height: 2;
    }

    /* ============================================================
       VAULT UNLOCKED PANEL
    ============================================================ */
    #vault-content {
      display: none;
      margin-top: 2rem;
      border: 1px solid rgba(160,160,255,0.2);
      padding: 2rem;
      background: rgba(160,160,255,0.02);
    }

    #vault-content.visible { display: block; animation: fadeInUp 0.6s ease; }

    .vault-doc-header {
      font-size: 0.55rem;
      letter-spacing: 0.25em;
      color: var(--accent-hot);
      margin-bottom: 1.5rem;
      text-transform: uppercase;
    }

    .vault-doc-body {
      font-size: 0.65rem;
      color: var(--ash);
      line-height: 2;
    }

    .vault-doc-body h3 {
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: 1rem;
      color: var(--bone);
      margin-bottom: 0.8rem;
    }

    .vault-doc-body p { margin-bottom: 1em; }

    /* ============================================================
       GLITCH DISTORTION OVERLAY (occasional)
    ============================================================ */
    .glitch-distort {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 9996;
      opacity: 0;
    }

    /* ============================================================
       RESPONSIVE
    ============================================================ */
    @media (max-width: 768px) {
      .hero-grid {
        grid-template-columns: 1fr;
        gap: 2.5rem;
      }

      .hero-panel {
        width: 100%;
      }

      .archive-grid {
        grid-template-columns: 1fr;
      }

      nav { display: none; }

      footer {
        flex-direction: column;
        align-items: flex-start;
      }

      .footer-right { text-align: left; }
    }

    /* ============================================================
       AUDIO PLAYER
    ============================================================ */
    .player-ui {
      margin-top: 1.6rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .play-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--ghost);
      font-family: var(--font-mono);
      font-size: 0.58rem;
      letter-spacing: 0.2em;
      padding: 0.65rem 1.2rem;
      cursor: pointer;
      text-transform: uppercase;
      text-align: left;
      transition: color 0.2s, border-color 0.2s, background 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      width: fit-content;
    }

    .play-btn:hover {
      color: var(--accent);
      border-color: rgba(160,160,255,0.4);
      background: rgba(160,160,255,0.03);
    }

    .play-btn.playing {
      color: var(--accent-hot);
      border-color: rgba(160,160,255,0.5);
    }

    .play-icon { font-size: 0.5rem; }

    .progress-wrap {
      height: 1px;
      background: var(--border);
      cursor: pointer;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: var(--accent-hot);
      width: 0%;
      transition: width 0.1s linear;
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      right: -3px;
      top: -3px;
      width: 7px;
      height: 7px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .progress-wrap:hover .progress-bar::after { opacity: 1; }

    .time-display {
      font-size: 0.52rem;
      color: var(--dim);
      letter-spacing: 0.12em;
    }

        /* Card con player — card non intercetta click, tutto dentro sì */
        .archive-item.has-player {
          pointer-events: none;
          cursor: default;
        }

        .archive-item.has-player > *,
        .archive-item.has-player .player-ui,
        .archive-item.has-player .player-ui *,
        .archive-item.has-player .play-btn,
        .archive-item.has-player .progress-wrap,
        .archive-item.has-player button,
        .archive-item.has-player a {
          pointer-events: all;
        }
    /* ============================================================
       SYSTEM INTEGRITY BAR — fixed top strip
    ============================================================ */
    #integrity-bar-wrap {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 9999;
      height: 3px;
      background: var(--border-soft);
    }

    #integrity-bar-fill {
      height: 100%;
      width: 20%; /* 2/10 default */
      background: var(--danger);
      transition: width 1.2s cubic-bezier(.4,0,.2,1), background 1.2s ease;
    }

    /* colour shifts: red → gold → accent */
    #integrity-bar-fill.mid  { background: var(--gold); }
    #integrity-bar-fill.high { background: var(--accent-hot); }
    #integrity-bar-fill.full { background: #ffd700; box-shadow: 0 0 12px rgba(255,215,0,0.6); }

    /* push header down by 3px */
    header { top: 3px !important; }

    /* ============================================================
       NEURO-LINK SCREEN
    ============================================================ */
    #neuro-screen {
      position: fixed;
      inset: 0;
      z-index: 8000;
      background: var(--black);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 1s ease, visibility 1s ease;
      overflow-y: auto;
      padding: 2rem var(--gutter);
    }

    #neuro-screen.active  { opacity: 1; visibility: visible; }
    #neuro-screen.dismissed { opacity: 0; visibility: hidden; pointer-events: none; }

    .neuro-inner {
      width: min(520px, 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }

    .neuro-header {
      font-size: 0.72rem;
      letter-spacing: 0.3em;
      color: var(--silver);
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .neuro-blink {
      color: var(--accent);
      animation: blink-cursor 0.6s step-end infinite;
      font-size: 0.6rem;
    }

    .neuro-audio-req {
      font-size: 0.55rem;
      letter-spacing: 0.2em;
      color: var(--ghost);
      text-align: center;
      opacity: 0;
      transition: opacity 0.8s ease 0.5s;
    }

    #neuro-screen.active .neuro-audio-req { opacity: 1; }

    .neuro-player {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      opacity: 0;
      transition: opacity 0.8s ease 0.8s;
    }

    #neuro-screen.active .neuro-player { opacity: 1; }

    .neuro-time-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .neuro-countdown {
      font-size: 0.52rem;
      letter-spacing: 0.12em;
      color: var(--ghost);
    }

    .neuro-countdown.done { color: var(--accent-hot); }

    /* Transmission progress bar */
    .neuro-listen-wrap {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .neuro-listen-label {
      font-size: 0.52rem;
      letter-spacing: 0.2em;
      color: var(--muted);
    }

    .neuro-listen-track {
      height: 2px;
      background: var(--border);
      width: 100%;
      position: relative;
    }

    .neuro-listen-bar {
      height: 100%;
      width: 0%;
      background: var(--accent);
      transition: width 0.5s linear, background 0.5s ease;
      position: relative;
    }

    .neuro-listen-bar::after {
      content: '';
      position: absolute;
      right: -4px; top: -3px;
      width: 8px; height: 8px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .neuro-listen-bar.active::after { opacity: 1; }
    .neuro-listen-bar.complete { background: var(--accent-hot); }

    /* Bypass input */
    .neuro-bypass {
      width: 100%;
      border-top: 1px solid var(--border-soft);
      padding-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      opacity: 0;
      transition: opacity 0.8s ease 2s;
    }

    #neuro-screen.active .neuro-bypass { opacity: 1; }

    .neuro-bypass-label {
      font-size: 0.5rem;
      letter-spacing: 0.18em;
      color: var(--dim);
      text-align: center;
    }

    .neuro-bypass-row {
      display: flex;
      border: 1px solid var(--border);
      transition: border-color 0.3s;
    }

    .neuro-bypass-row:focus-within { border-color: var(--accent); }

    .neuro-bypass-prefix {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 0 1rem;
      font-size: 0.6rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      letter-spacing: 0.1em;
      white-space: nowrap;
      font-family: var(--font-mono);
    }

    #neuro-key {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      color: var(--white);
      padding: 0.7rem 1rem;
      text-transform: uppercase;
    }

    #neuro-key::placeholder { color: var(--dim); }

    #neuro-key-submit {
      background: none;
      border: none;
      border-left: 1px solid var(--border);
      padding: 0 1rem;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--ghost);
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
    }

    #neuro-key-submit:hover { color: var(--accent); background: rgba(160,160,255,0.05); }

    .neuro-bypass-resp {
      font-size: 0.58rem;
      letter-spacing: 0.1em;
      color: var(--dim);
      min-height: 1.2em;
    }

    .neuro-bypass-resp.ok  { color: var(--accent-hot); }
    .neuro-bypass-resp.err { color: var(--danger); }
    .neuro-bypass-hint {
      margin: 0.8rem 0 0;
      font-size: 0.48rem;
      letter-spacing: 0.12em;
      color: var(--dim);
      font-style: italic;
    }

    /* Proceed button */
    #epigrafe-proceed {
      opacity: 0;
      pointer-events: none;
      background: none;
      border: 1px solid var(--border);
      font-family: var(--font-mono);
      font-size: 0.62rem;
      letter-spacing: 0.25em;
      color: var(--silver);
      text-transform: uppercase;
      cursor: pointer;
      padding: 0.8rem 2.4rem;
      transition: opacity 0.8s ease, color 0.3s, border-color 0.3s;
      position: relative;
    }

    #epigrafe-proceed.visible {
      opacity: 1;
      pointer-events: all;
    }

    #epigrafe-proceed:hover {
      color: var(--accent);
      border-color: var(--accent);
      background: rgba(160,160,255,0.04);
    }

    /* ============================================================
       EPIGRAFE / NEURO SHARED PLAYER STYLES
    ============================================================ */
    .epigrafe-play-btn {
      background: none;
      border: 1px solid var(--border);
      font-family: var(--font-mono);
      font-size: 0.62rem;
      letter-spacing: 0.2em;
      color: var(--silver);
      text-transform: uppercase;
      cursor: pointer;
      padding: 0.7rem 1.8rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      transition: color 0.3s, border-color 0.3s;
      width: 100%;
      justify-content: center;
    }

    .epigrafe-play-btn:hover  { color: var(--white); border-color: var(--ghost); }
    .epigrafe-play-btn.playing { color: var(--accent-hot); border-color: var(--accent-hot); }

    .epigrafe-progress {
      height: 1px;
      background: var(--dim);
      cursor: pointer;
      width: 100%;
    }

    .epigrafe-progress-bar {
      height: 100%;
      background: var(--silver);
      width: 0%;
      transition: width 0.1s linear;
    }

    .epigrafe-time {
      font-size: 0.52rem;
      color: var(--ghost);
      letter-spacing: 0.12em;
    }

    /* Quote rotator */
    .epigrafe-quotes {
      width: min(480px, 100%);
      text-align: center;
      position: relative;
      min-height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .epigrafe-quote {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: clamp(0.9rem, 2.5vw, 1.2rem);
      color: var(--white);
      opacity: 0;
      transition: opacity 1s ease;
      pointer-events: none;
    }

    .epigrafe-quote.active { opacity: 1; }
    .epigrafe-quote::before { content: '\201C'; margin-right: 0.15em; color: var(--ghost); }
    .epigrafe-quote::after  { content: '\201D'; margin-left:  0.15em; color: var(--ghost); }

    /* ============================================================
       GOLD MODE — dramatic full palette shift
    ============================================================ */
    body.gold-mode {
      --black:       #070500;
      --void:        #0e0a00;
      --surface:     #161100;
      --border:      #3d3000;
      --border-soft: #282000;
      --dim:         #6e5800;
      --muted:       #a08000;
      --ghost:       #c8a200;
      --ash:         #e2c040;
      --silver:      #f0d870;
      --bone:        #f8eba0;
      --white:       #fff8cc;
      --accent:      #ffd700;
      --accent-hot:  #ffb300;
      --gold:        #ffd700;
      --gold-dim:    #c89800;
      --danger:      #ff8c00;
    }

    body.gold-mode header {
      background: rgba(7,5,0,0.96);
      border-bottom: 1px solid rgba(255,215,0,0.12);
    }

    body.gold-mode .wordmark { color: #ffd700; }

    body.gold-mode .archive-item {
      border-color: rgba(255,215,0,0.07);
    }
    body.gold-mode .archive-item:not(.locked):hover {
      background: var(--surface);
      box-shadow: 0 0 40px rgba(255,215,0,0.05);
    }

    body.gold-mode .file-name   { color: var(--bone); }
    body.gold-mode .section-title { color: #ffd700; }

    body.gold-mode .vault-terminal,
    body.gold-mode #minigame-terminal {
      border-color: rgba(255,215,0,0.2);
      background: rgba(14,10,0,0.6);
    }

    body.gold-mode .progress-bar { background: #ffd700; }
    body.gold-mode .play-btn.playing { color: #ffd700; border-color: rgba(255,215,0,0.5); }
    body.gold-mode .status-badge.active { color: #ffd700; border-color: rgba(255,215,0,0.3); }

    body.gold-mode .file-access-bar::after {
      background: linear-gradient(90deg, transparent, #ffd700, transparent);
    }

    body.gold-mode .hero-title .glitch::before { color: #ffd700; }
    body.gold-mode .hero-title .glitch::after  { color: #fff8cc; }

    body.gold-mode .manifesto-strip {
      border-color: rgba(255,215,0,0.1);
    }
    body.gold-mode .ticker-item {
      color: var(--ghost);
    }

    /* Pulsing gold radial glow from top */
    body.gold-mode #main-content {
      position: relative;
    }
    body.gold-mode #main-content::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; height: 40vh;
      pointer-events: none;
      background: radial-gradient(ellipse at 50% -10%, rgba(255,215,0,0.06) 0%, transparent 70%);
      z-index: 0;
    }

    body.gold-mode #integrity-bar-fill {
      background: linear-gradient(90deg, #b87e00, #ffd700, #fffaaa, #ffd700, #b87e00);
      background-size: 300% 100%;
      animation: goldShimmer 2s linear infinite;
      box-shadow: 0 0 10px rgba(255,215,0,0.6), 0 0 20px rgba(255,215,0,0.3);
    }

    @keyframes goldShimmer {
      0%   { background-position: 0% 0; }
      100% { background-position: 300% 0; }
    }


    /* ============================================================
       MEMORY PROTOCOL MINIGAME
    ============================================================ */
    #minigame-section {
      border-top: 1px solid var(--border-soft);
      padding: 6rem var(--gutter);
    }

    #mg-hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.55rem;
      letter-spacing: 0.2em;
      margin-bottom: 1.4rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--border-soft);
    }

    #mg-level-display { color: var(--silver); }
    #mg-phase-display { color: var(--accent); transition: color 0.4s; }
    #mg-phase-display.recall  { color: var(--gold); }

    #mg-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      max-width: 380px;
      margin: 0 auto 1.4rem;
      touch-action: manipulation;
      user-select: none;
    }

    @media (max-width: 500px) {
      #mg-grid { max-width: 280px; gap: 6px; }
    }

    .mg-cell {
      aspect-ratio: 1;
      background: var(--void);
      border: 1px solid var(--border);
      cursor: default;
      position: relative;
      transition: background 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease, transform 0.08s ease;
      -webkit-tap-highlight-color: transparent;
      pointer-events: all;
    }

    .mg-cell.flash {
      background: var(--accent);
      border-color: var(--accent);
      box-shadow: 0 0 18px rgba(160,160,255,0.55);
      transform: scale(0.96);
    }

    .mg-cell.interactive { cursor: pointer; }
    .mg-cell.interactive:hover  { background: rgba(160,160,255,0.07); border-color: var(--ghost); }
    .mg-cell.interactive:active { transform: scale(0.94); }

    .mg-cell.selected {
      background: rgba(160,160,255,0.18);
      border-color: var(--accent-hot);
    }

    .mg-cell.correct {
      background: rgba(160,160,255,0.28);
      border-color: var(--accent);
      box-shadow: 0 0 12px rgba(160,160,255,0.3);
    }

    .mg-cell.wrong {
      background: rgba(255,68,68,0.22);
      border-color: var(--danger);
      box-shadow: 0 0 12px rgba(255,68,68,0.25);
    }

    #mg-message {
      font-size: 0.56rem;
      letter-spacing: 0.15em;
      color: var(--ghost);
      text-align: center;
      min-height: 1.6em;
      margin-bottom: 1rem;
      transition: color 0.3s;
    }
    #mg-message.ok   { color: var(--accent-hot); }
    #mg-message.warn { color: var(--gold); }
    #mg-message.fail { color: var(--danger); }

    #minigame-win {
      border-top: 1px solid var(--border-soft);
      padding-top: 2rem;
      margin-top: 1rem;
      animation: fadeInUp 0.8s ease;
    }

    #mg-win-headline {
      font-size: 0.6rem;
      letter-spacing: 0.25em;
      color: var(--accent-hot);
      margin-bottom: 1.2rem;
    }

    #mg-win-quote {
      font-family: var(--font-serif);
      font-style: italic;
      font-weight: 200;
      font-size: clamp(1rem, 2.5vw, 1.35rem);
      color: var(--white);
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    #mg-win-sub {
      font-size: 0.52rem;
      letter-spacing: 0.18em;
      color: var(--ghost);
      margin-bottom: 1.6rem;
    }

    #mg-fail-headline {
      font-size: 0.58rem;
      letter-spacing: 0.25em;
      color: var(--danger);
      margin-bottom: 0.7rem;
    }

    #mg-fail-sub {
      font-size: 0.56rem;
      letter-spacing: 0.1em;
      color: var(--ghost);
      margin-bottom: 0;
    }

    /* Scrollbar */
    ::-webkit-scrollbar       { width: 4px; }
    ::-webkit-scrollbar-track { background: var(--black); }
    ::-webkit-scrollbar-thumb { background: var(--border); }
    ::-webkit-scrollbar-thumb:hover { background: var(--muted); }


    /* ============================================================
       STARFIELD CANVAS
    ============================================================ */
    #starfield-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      transition: opacity 2s ease;
    }
    #starfield-canvas.visible { opacity: 1; }

    /* ============================================================
       NECROSIS GLITCH
    ============================================================ */
    body.necrosis-active {
      animation: necrosis-body 0.08s steps(1) infinite;
    }
    @keyframes necrosis-body {
      0%   { filter: none; }
      15%  { filter: hue-rotate(180deg) invert(0.06); }
      30%  { filter: none; }
      45%  { filter: brightness(1.4) contrast(1.2); }
      60%  { filter: none; }
      75%  { filter: hue-rotate(90deg) saturate(2); }
      100% { filter: none; }
    }
    .necrosis-slice {
      position: fixed;
      left: 0; right: 0;
      pointer-events: none;
      z-index: 9996;
      mix-blend-mode: difference;
      animation: necrosis-slice-anim 0.12s steps(1) infinite;
    }
    @keyframes necrosis-slice-anim {
      0%   { opacity: 0; }
      20%  { opacity: 1; transform: translateX(-8px); background: rgba(255,0,80,0.08); }
      40%  { opacity: 0; }
      60%  { opacity: 1; transform: translateX(6px);  background: rgba(0,255,200,0.06); }
      80%  { opacity: 0; }
      100% { opacity: 0; }
    }


    /* ============================================================
       SIGNAL SCAN MINIGAME (SECTION_04 — COLD_OPTICS)
    ============================================================ */
    #signal-scan-section {
      border-top: 1px solid var(--border-soft);
      padding: 6rem var(--gutter);
    }
    #ss-hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.55rem;
      letter-spacing: 0.2em;
      margin-bottom: 1.4rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--border-soft);
    }
    #ss-freq-display {
      color: #00d4e8;
      font-size: 0.72rem;
      letter-spacing: 0.28em;
      font-variant-numeric: tabular-nums;
    }
    #ss-status-display { color: var(--ghost); transition: color 0.4s; }
    #ss-status-display.acquiring { color: #00d4e8; }
    #ss-status-display.locked    { color: var(--accent-hot); animation: blink-cursor 0.6s step-end infinite; }
    #ss-scope-wrap {
      position: relative;
      border: 1px solid var(--border);
      background: #010508;
      margin-bottom: 1.2rem;
      overflow: hidden;
    }
    #ss-canvas {
      display: block;
      width: 100%;
      height: 80px;
    }
    #ss-scope-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      padding: 0.35rem 0.6rem;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
    }
    .ss-scope-label {
      font-size: 0.44rem;
      letter-spacing: 0.15em;
      color: rgba(0,212,232,0.45);
    }
    #ss-signal-bars {
      display: flex;
      align-items: flex-end;
      gap: 5px;
      margin-bottom: 1.4rem;
      height: 28px;
    }
    .ss-bar-label {
      font-size: 0.44rem;
      letter-spacing: 0.15em;
      color: var(--dim);
      margin-right: 4px;
      align-self: center;
    }
    .ss-bar {
      width: 10px;
      background: var(--border);
      border-radius: 1px;
      transition: background 0.25s, box-shadow 0.25s;
    }
    .ss-bar:nth-child(2) { height: 8px; }
    .ss-bar:nth-child(3) { height: 12px; }
    .ss-bar:nth-child(4) { height: 16px; }
    .ss-bar:nth-child(5) { height: 20px; }
    .ss-bar:nth-child(6) { height: 24px; }
    .ss-bar.active {
      background: #00d4e8;
      box-shadow: 0 0 8px rgba(0,212,232,0.45);
    }
    #ss-signal-pct {
      font-size: 0.5rem;
      letter-spacing: 0.15em;
      color: var(--dim);
      margin-left: 8px;
      align-self: center;
      transition: color 0.3s;
      font-variant-numeric: tabular-nums;
      min-width: 3.5ch;
    }
    #ss-tuner-wrap { margin-bottom: 1.2rem; }
    #ss-tuner-track {
      position: relative;
      height: 34px;
      background: var(--void);
      border: 1px solid var(--border);
      cursor: crosshair;
      touch-action: none;
      user-select: none;
      overflow: hidden;
    }
    #ss-tuner-interference {
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 3px,
        rgba(255,255,255,0.012) 3px,
        rgba(255,255,255,0.012) 4px
      );
      pointer-events: none;
    }
    #ss-tuner-needle {
      position: absolute;
      top: 0; bottom: 0;
      width: 2px;
      background: #00d4e8;
      box-shadow: 0 0 10px rgba(0,212,232,0.5), 0 0 22px rgba(0,212,232,0.25);
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
      transition: box-shadow 0.3s;
    }
    #ss-tuner-needle::before {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 5px solid #00d4e8;
    }
    #ss-tuner-needle.locked {
      box-shadow: 0 0 14px rgba(0,212,232,0.9), 0 0 30px rgba(0,212,232,0.5);
    }
    #ss-tuner-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 0.42rem;
      color: var(--dim);
      letter-spacing: 0.08em;
    }
    #ss-message {
      font-size: 0.56rem;
      letter-spacing: 0.15em;
      color: var(--ghost);
      text-align: center;
      min-height: 1.6em;
      margin-bottom: 0.8rem;
      transition: color 0.3s;
    }
    #ss-message.acquiring { color: #00d4e8; }
    #ss-message.locked    { color: var(--accent-hot); }
    #ss-hold-wrap { margin-bottom: 0.8rem; }
    #ss-hold-label {
      font-size: 0.45rem;
      letter-spacing: 0.22em;
      color: #00d4e8;
      margin-bottom: 5px;
      animation: blink-cursor 0.5s step-end infinite;
    }
    #ss-hold-track {
      height: 3px;
      background: var(--border);
    }
    #ss-hold-bar {
      height: 100%;
      width: 0%;
      background: #00d4e8;
      box-shadow: 0 0 8px rgba(0,212,232,0.5);
      transition: width 0.1s linear;
    }
    #ss-win {
      border-top: 1px solid var(--border-soft);
      padding-top: 2rem;
      margin-top: 1rem;
      animation: fadeInUp 0.8s ease;
    }
    #ss-win-headline {
      font-size: 0.6rem;
      letter-spacing: 0.25em;
      color: #00d4e8;
      margin-bottom: 1.2rem;
    }
    #ss-win-quote {
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: 1.05rem;
      color: var(--bone);
      margin-bottom: 0.8rem;
      line-height: 1.6;
    }
    #ss-win-sub {
      font-size: 0.52rem;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 1.6rem;
    }
    @media (max-width: 500px) {
      #ss-canvas { height: 60px; }
      #ss-tuner-track { height: 44px; }
    }

    /* ============================================================
       GLASS TEARS — STATIC WEEP MINIGAME (SECTION_05)
    ============================================================ */
    #glass-tears-section {
      border-top: 1px solid var(--border-soft);
      padding: 6rem var(--gutter);
    }

    #gt-terminal {
      max-width: 760px;
    }

    #gt-canvas-wrap {
      position: relative;
      background: #01020a;
      border: 1px solid var(--border);
      overflow: hidden;
      margin-bottom: 1.4rem;
    }

    #gt-canvas {
      display: block;
      width: 100%;
      height: 200px;
    }

    #gt-canvas-wrap::before {
      content: 'STATIC WEEP — INTERCEPTING SIGNAL';
      position: absolute;
      top: 0.5rem; left: 0.8rem;
      font-size: 0.4rem;
      letter-spacing: 0.18em;
      color: rgba(180,180,255,0.22);
      pointer-events: none;
      z-index: 2;
    }

    #gt-canvas-wrap::after {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent, transparent 3px,
        rgba(0,0,0,0.08) 3px, rgba(0,0,0,0.08) 4px
      );
      pointer-events: none;
      z-index: 1;
    }

    #gt-hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.55rem;
      letter-spacing: 0.2em;
      margin-bottom: 1.2rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--border-soft);
    }

    #gt-lives {
      display: flex;
      gap: 0.35rem;
      align-items: center;
    }

    .gt-life {
      display: inline-block;
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--accent-hot);
      box-shadow: 0 0 6px var(--accent-hot);
      transition: background 0.3s, box-shadow 0.3s;
    }

    .gt-life.lost {
      background: var(--border);
      box-shadow: none;
    }

    #gt-counter-label { color: var(--ghost); }
    #gt-counter       { color: #a8d8ff; letter-spacing: 0.1em; font-variant-numeric: tabular-nums; }
    #gt-wave-label    { color: var(--dim); }

    #gt-message {
      font-size: 0.56rem;
      letter-spacing: 0.15em;
      color: var(--ghost);
      text-align: center;
      min-height: 1.6em;
      margin-bottom: 0.8rem;
      transition: color 0.2s;
    }
    #gt-message.hit   { color: #a8d8ff; }
    #gt-message.miss  { color: var(--danger); }
    #gt-message.warn  { color: var(--gold); }

    /* Win state */
    #gt-win {
      border-top: 1px solid var(--border-soft);
      padding-top: 2rem;
      margin-top: 1rem;
      animation: fadeInUp 0.8s ease;
    }
    #gt-win-headline {
      font-size: 0.6rem;
      letter-spacing: 0.25em;
      color: #a8d8ff;
      margin-bottom: 1.2rem;
    }
    #gt-win-quote {
      font-family: var(--font-serif);
      font-weight: 200;
      font-style: italic;
      font-size: 1.05rem;
      color: var(--bone);
      margin-bottom: 0.8rem;
      line-height: 1.6;
    }
    #gt-win-sub {
      font-size: 0.52rem;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 1.6rem;
    }

    /* Fail state */
    #gt-fail {
      border-top: 1px solid var(--border-soft);
      padding-top: 1.5rem;
      margin-top: 1rem;
      animation: fadeInUp 0.5s ease;
    }
    #gt-fail-headline {
      font-size: 0.58rem;
      letter-spacing: 0.22em;
      color: var(--danger);
      margin-bottom: 1rem;
    }

    /* ============================================================
       CURSOR TRAIL
    ============================================================ */
    .cursor-spark {
      position: fixed;
      pointer-events: none;
      z-index: 9990;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: spark-fade 0.55s ease-out forwards;
    }

    @keyframes spark-fade {
      0%   { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0;   transform: translate(-50%, -50%) scale(0.1); }
    }

    /* ============================================================
       MORSE DOT
    ============================================================ */
    #morse-dot {
      position: fixed;
      bottom: 1.2rem;
      left: 1.4rem;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--accent-hot);
      pointer-events: none;
      z-index: 9500;
      opacity: 0.08;
      transition: opacity 0.04s linear, box-shadow 0.04s linear;
    }
    #morse-dot.on {
      opacity: 0.72;
      box-shadow: 0 0 6px rgba(160,160,255,0.8), 0 0 14px rgba(160,160,255,0.4);
    }
    body.gold-mode #morse-dot { background: #ffd700; }
    body.gold-mode #morse-dot.on {
      box-shadow: 0 0 6px rgba(255,215,0,0.9), 0 0 14px rgba(255,215,0,0.5);
    }

    /* ============================================================
       AUDIO VISUALIZER
    ============================================================ */
    .viz-canvas {
      display: block;
      width: 100%;
      height: 36px;
      opacity: 0;
      transition: opacity 0.6s ease;
      pointer-events: none;
      border-top: 1px solid var(--border-soft);
      margin-top: 0.4rem;
    }
    .viz-canvas.active { opacity: 1; }

    body.gold-mode .viz-canvas { filter: sepia(1) saturate(3) hue-rotate(5deg); }

    /* ============================================================
       GHOST CURSOR
    ============================================================ */
    #ghost-cursor {
      position: fixed;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      pointer-events: none;
      z-index: 9996;
      opacity: 0;
      transform: translate(-50%, -50%);
      transition: opacity 0.4s ease;
      box-shadow: 0 0 8px rgba(160,160,255,0.6);
    }
    #ghost-cursor.visible { opacity: 0.55; }

    #ghost-cursor-ring {
      position: fixed;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 1px solid rgba(160,160,255,0.3);
      pointer-events: none;
      z-index: 9995;
      opacity: 0;
      transform: translate(-50%, -50%);
      transition: opacity 0.4s ease, width 0.12s ease, height 0.12s ease;
    }
    #ghost-cursor-ring.visible { opacity: 0.4; }
    #ghost-cursor-ring.clicking {
      width: 14px; height: 14px;
      border-color: rgba(160,160,255,0.7);
    }

  </style>
</head>
<body>

  <!-- GHOST CURSOR -->
  <div id="ghost-cursor"      aria-hidden="true"></div>
  <div id="ghost-cursor-ring" aria-hidden="true"></div>

  <!-- MORSE DOT — hidden signal -->
  <div id="morse-dot" aria-hidden="true" title=""></div>



  <!-- SYSTEM INTEGRITY BAR -->
  <div id="integrity-bar-wrap" aria-hidden="true">
    <div id="integrity-bar-fill"></div>
  </div>

  <!-- ============================================================
       BOOT SCREEN
  ============================================================ -->
  
  <canvas id="starfield-canvas" aria-hidden="true"></canvas>
  <div id="boot-screen">
    <div class="boot-log" id="boot-log" aria-live="polite"></div>
    <hr class="boot-separator" id="boot-sep" />
    <button id="proceed-btn" aria-label="Proceed">ENTER THE ARCHIVE</button>
  </div>

  <!-- ============================================================
       NEURO-LINK SCREEN
  ============================================================ -->
  <div id="neuro-screen">
    <audio id="epigrafe-audio" preload="metadata" src="MCenotaph_CENOTAPH_INTRO.mp3"></audio>
    <div class="neuro-inner">
      <div class="neuro-header">
        <span id="neuro-status-text">SYNCING NEURO-LINK...</span>
        <span class="neuro-blink">█</span>
      </div>
      <div class="neuro-audio-req" id="neuro-audio-req">[ AUDIO REQUIRED — INITIALIZING TRANSMISSION ]</div>
      <div class="neuro-player">
        <button class="epigrafe-play-btn" id="epigrafe-play-btn" onclick="toggleEpigrafe()">
          <span id="epigrafe-icon">▶</span>&nbsp; PLAY INTRO — M. CENOTAPH
        </button>
        <div class="epigrafe-progress" id="epigrafe-progress" onclick="seekEpigrafe(event)">
          <div class="epigrafe-progress-bar" id="epigrafe-progress-bar"></div>
        </div>
        <div class="neuro-time-row">
          <span class="epigrafe-time" id="epigrafe-time">00:00</span>
          <span class="neuro-countdown" id="neuro-countdown">69s required</span>
        </div>
      </div>
      <div class="neuro-listen-wrap">
        <div class="neuro-listen-label">TRANSMISSION PROGRESS</div>
        <div class="neuro-listen-track">
          <div class="neuro-listen-bar" id="neuro-listen-bar"></div>
        </div>
      </div>
      <div class="neuro-bypass" id="neuro-bypass">
        <div class="neuro-bypass-label">— OR INSERT AUTHORIZATION KEY TO BYPASS —</div>
        <div class="neuro-bypass-row">
          <span class="neuro-bypass-prefix">KEY://</span>
          <input type="password" id="neuro-key" placeholder="AUTHORIZATION KEY" autocomplete="off" spellcheck="false" maxlength="32" />
          <button id="neuro-key-submit">↵</button>
        </div>
        <p class="neuro-bypass-resp" id="neuro-bypass-resp"></p>
        <p class="neuro-bypass-hint">⌇ Method: asphyxiation by luxury — 8 characters, all caps</p>
      </div>
      <button id="epigrafe-proceed">ACCESS GRANTED &nbsp;→</button>
      <div class="epigrafe-quotes" aria-live="polite">
        <span class="epigrafe-quote active" id="eq-0">Preserved. Fresh. Dead.</span>
        <span class="epigrafe-quote" id="eq-1">Five-star silence.</span>
        <span class="epigrafe-quote" id="eq-2">Empty on the inside, heavy on the out.</span>
        <span class="epigrafe-quote" id="eq-3">Don't breathe too loud.</span>
        <span class="epigrafe-quote" id="eq-4">And it feels expensive.</span>
        <span class="epigrafe-quote" id="eq-5">No blood on the apron.</span>
        <span class="epigrafe-quote" id="eq-6">The floor is made of everything I lost.</span>
        <span class="epigrafe-quote" id="eq-7">Welcome to the nothing.</span>
      </div>
    </div>
  </div>

  <!-- ============================================================
       GLITCH OVERLAY
  ============================================================ -->
  <div class="glitch-distort" id="glitch-distort"></div>

  <!-- ============================================================
       MAIN CONTENT
  ============================================================ -->
  <div id="main-content">

    <!-- HEADER -->
    <header>
      <div class="header-inner">
        <a href="#" class="wordmark">M. CENOTAPH</a>
        <div class="header-status">
          <span class="dot"></span>ARCHIVE ONLINE — ACCESS LEVEL: CONDITIONAL
        </div>
        <nav aria-label="Archive navigation">
          <a href="#archive" class="nav-link">FILE_001</a>
          <a href="#archive" class="nav-link">EVIDENCE_A</a>
          <a href="#vault"   class="nav-link" data-locked>THE VAULT</a>
          <a href="#archive" class="nav-link" data-locked>ARCHIVE_LOG</a>
        </nav>
      </div>
    </header>

    <!-- HERO -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-grid">
        <div class="hero-left">
          <p class="hero-prefix">ARCHIVE RECOVERED — 2024</p>

          <h1 class="hero-title" id="hero-title">
            <span class="m-prefix">M.</span>
            <span class="glitch" data-text="CENOTAPH">CENOTAPH</span>
          </h1>

          <p class="hero-subtitle">
            A monument with no body beneath it.<br/>
            <em>The subject designated M.</em> built the vault, polished the stone,
            set the table. Then disappeared inside the architecture.
            What follows is not music. It is forensic evidence —
            preserved, fresh, and irrefutably dead.
          </p>

          <div class="hero-cta-row">
            <a href="#archive" class="btn-primary">
              <span>ACCESS ARCHIVE</span>
              <span>→</span>
            </a>
            <a href="#vault" class="btn-ghost">Request Vault Authorization</a>
          </div>
        </div>

        <div class="hero-panel" role="complementary" aria-label="System status">
          <div class="panel-row">
            <span class="panel-label">STATUS</span>
            <span class="panel-val live" id="sys-status">ACTIVE</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">FILES RECOVERED</span>
            <span class="panel-val" id="sys-files">02 / 12</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">ACCESS LEVEL</span>
            <span class="panel-val" id="sys-access">CONDITIONAL</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">VAULT</span>
            <span class="panel-val locked" id="sys-vault">LOCKED</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">BPM</span>
            <span class="panel-val">182</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">SYSTEM INTEGRITY</span>
            <span class="panel-val" id="sys-integrity">74.3%</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">LAST BREACH</span>
            <span class="panel-val" id="sys-breach">—</span>
          </div>
          <div class="panel-row">
            <span class="panel-label">SUBJECT PROFILE</span>
            <span class="panel-val" id="sys-subject">UNKNOWN</span>
          </div>
        </div>
      </div>
    </section>

    <!-- MANIFESTO TICKER -->
    <div class="manifesto-strip" aria-hidden="true">
      <div class="manifesto-ticker" id="ticker">
        <span class="ticker-item">Preserved. Fresh. Dead.</span>
        <span class="ticker-item">Five-star silence</span>
        <span class="ticker-item">182 BPM — the resting heart rate of controlled collapse</span>
        <span class="ticker-item">The floor is made of everything I lost</span>
        <span class="ticker-item">The archive does not welcome. It authorizes.</span>
        <span class="ticker-item">No blood on the apron. Immaculate presentation.</span>
        <span class="ticker-item">Every scar is a pillar, built it to last</span>
        <span class="ticker-item">The void is not empty — it is a masterpiece</span>
        <span class="ticker-item">Preserved. Fresh. Dead.</span>
        <span class="ticker-item">Five-star silence</span>
        <span class="ticker-item">182 BPM — the resting heart rate of controlled collapse</span>
        <span class="ticker-item">The floor is made of everything I lost</span>
        <span class="ticker-item">The archive does not welcome. It authorizes.</span>
        <span class="ticker-item">No blood on the apron. Immaculate presentation.</span>
        <span class="ticker-item">Every scar is a pillar, built it to last</span>
        <span class="ticker-item">The void is not empty — it is a masterpiece</span>
      </div>
    </div>

    <!-- ARCHIVE FILES -->
    <section id="archive" aria-labelledby="archive-heading">
      <div class="section-header">
        <span class="section-code">SECTION_01</span>
        <h2 class="section-title" id="archive-heading">Recovered Files</h2>
        <div class="section-rule"></div>
        <span class="section-code">03 DOCUMENTS</span>
      </div>

      <div class="archive-grid">

        <!-- FILE_001 — AVAILABLE -->
        <article class="archive-item has-player" aria-label="File 001: Vacuum Sealed">
          <div class="file-tag">
            <span>FILE_001</span>
            <span class="status-badge active">AVAILABLE</span>
          </div>
          <h3 class="file-name">Vacuum Sealed</h3>
          <p class="file-desc">
            Atmospheric pressure: Maximum. Oxygen: Expelled. A sonic study in clinical hyper-vigilance, where 182 BPM pulse meets the paranoid. The sound of a life lived in a pneumatic void—tight, cold, and absolute. There is no room to breathe. Only to perform. Format: Underground Orchestral Liquid DnB, 182 BPM.
          </p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val">2024.01.09</span></span>
            <span><span>INTEGRITY</span><span class="val">99.1%</span></span>
            <span><span>CLASSIFICATION</span><span class="val">PUBLIC — LEVEL 0</span></span>
          </div>
          <div class="file-access-bar"></div>

          <audio id="player-file-001" preload="metadata" src="MCenotaph_VACUUM_SEALED.mp3"></audio>
          <div class="player-ui" id="player-ui-001">
            <button class="play-btn" id="play-btn-001" aria-label="Play Vacuum Sealed">
              <span id="play-icon-001">▶</span>&nbsp; PLAY FILE_001
            </button>
            <div class="progress-wrap" id="progress-wrap-001">
              <div class="progress-bar" id="progress-bar-001"></div>
            </div>
            <span class="time-display" id="time-001">00:00</span>
          </div>
        </article>

        <!-- EVIDENCE_A — ACTIVE WITH PLAYER -->
        <article class="archive-item has-player" aria-label="Evidence A: Sweet Descent">
          <div class="file-tag">
            <span>EVIDENCE_A</span>
            <span class="status-badge active">AVAILABLE</span>
          </div>
          <h3 class="file-name">Sweet Descent</h3>
          <p class="file-desc">
            Drowning in the silk. The subject maps the pharmacology of aesthetic
            surrender — luxury as anaesthetic, gold-plated gravity as mechanism of
            controlled dissolution. Numb. Proper numb. And it feels expensive.
            Format: Orchestral Liquid DnB / Grime, 182 BPM.
          </p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val">2024.03.17</span></span>
            <span><span>INTEGRITY</span><span class="val">96.7%</span></span>
            <span><span>CLASSIFICATION</span><span class="val">PUBLIC — LEVEL 0</span></span>
          </div>
          <div class="file-access-bar"></div>

          <!-- AUDIO PLAYER -->
          <audio id="player-evidence-a" preload="metadata" src="MCenotaph_SWEET_DESCENT.mp3"></audio>

          <div class="player-ui" id="player-ui-a">
            <button class="play-btn" id="play-btn-a" aria-label="Play Sweet Descent">
              <span id="play-icon-a">▶</span>&nbsp; PLAY EVIDENCE_A
            </button>
            <div class="progress-wrap" id="progress-wrap-a">
              <div class="progress-bar" id="progress-bar-a"></div>
            </div>
            <span class="time-display" id="time-a">00:00</span>
          </div>
        </article>

        <!-- ARCHIVE_LOG -->
        <article class="archive-item locked" id="archive-log-card" tabindex="0" aria-label="Archive Log: Architect of Void — Classified">
          <div class="file-tag">
            <span>ARCHIVE_LOG</span>
            <span class="status-badge classified" id="archive-log-badge">CLASSIFIED</span>
          </div>
          <h3 class="file-name">Architect of Void</h3>
          <p class="file-desc">
            Terminal document. The subject does not rebuild from ruins —
            the subject builds on the fact that ruins are the only legitimate foundation.
            Every scar a pillar. Every debt a cornerstone. The void is not empty.
            It is a masterpiece. Vault authorization required.
          </p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="archive-log-recovered">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="archive-log-integrity">CORRUPTED</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="archive-log-class">VAULT — LEVEL 3</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="archive-log-lock" aria-hidden="true">⌇ LOCKED</span>

          <!-- Player — hidden until vault unlocked -->
          <audio id="player-archive-log" preload="metadata" src="MCenotaph_ARCHITECT_OF_VOID.mp3"></audio>
          <div class="player-ui" id="player-ui-log" style="display:none;">
            <button class="play-btn" id="play-btn-log" aria-label="Play Architect of Void">
              <span id="play-icon-log">▶</span>&nbsp; PLAY ARCHIVE_LOG
            </button>
            <div class="progress-wrap" id="progress-wrap-log">
              <div class="progress-bar" id="progress-bar-log"></div>
            </div>
            <span class="time-display" id="time-log">00:00</span>
          </div>
        </article>

      </div>
    </section>

    <!-- LOCKED FILES — SECTION 02 -->
    <section id="locked-files" aria-labelledby="locked-heading">
      <div class="section-header">
        <span class="section-code">SECTION_02</span>
        <h2 class="section-title" id="locked-heading">Classified Documents</h2>
        <div class="section-rule"></div>
        <span class="section-code">09 FRAGMENTS</span>
      </div>
      <div class="archive-grid">

        <article class="archive-item locked" id="card-silk" aria-label="File 002 — Classified">
          <div class="file-tag"><span>FILE_002</span><span class="status-badge classified" id="badge-silk">CORRUPTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Silk Garrotte</h3>
          <p class="file-desc">It ain't murder if you're smiling when you do it. Documentation of systematic self-elimination. Method: asphyxiation by luxury. Clean. Silent. Professional. Format: Orchestral Neurofunk, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-silk" style="color:var(--danger)">FAILED</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-silk" style="color:var(--danger)">12.4%</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-silk">RESTRICTED — LEVEL 1</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-silk" style="color:var(--danger)">⌇ CORRUPTED</span>
          <audio id="player-silk" preload="metadata" src="MCenotaph_SILK_GARROTTE.mp3"></audio>
          <div class="player-ui" id="ui-silk" style="display:none;">
            <button class="play-btn" id="play-btn-silk" aria-label="Play Silk Garrotte">
              <span id="play-icon-silk">▶</span>&nbsp; PLAY FILE_002
            </button>
            <div class="progress-wrap" id="progress-wrap-silk">
              <div class="progress-bar" id="progress-bar-silk"></div>
            </div>
            <span class="time-display" id="time-silk">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" id="card-ghost" aria-label="File 003 — Classified">
          <div class="file-tag"><span>FILE_003</span><span class="status-badge classified" id="badge-ghost">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Ghost Protocol</h3>
          <p class="file-desc">The subject learns to move through spaces without leaving evidence of occupancy. Invisibility as survival mechanism. The art of existing without disturbing the surface. Format: Orchestral Liquid DnB, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-ghost">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-ghost">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-ghost">RESTRICTED — LEVEL 1</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-ghost">⌇ LOCKED</span>
          <audio id="player-ghost" preload="metadata" src="MCenotaph_GHOST_PROTOCOL.mp3"></audio>
          <div class="player-ui" id="ui-ghost" style="display:none;">
            <button class="play-btn" id="play-btn-ghost" aria-label="Play Ghost Protocol">
              <span id="play-icon-ghost">▶</span>&nbsp; PLAY FILE_003
            </button>
            <div class="progress-wrap" id="progress-wrap-ghost">
              <div class="progress-bar" id="progress-bar-ghost"></div>
            </div>
            <span class="time-display" id="time-ghost">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" id="card-marble" aria-label="File 004 — Classified">
          <div class="file-tag"><span>FILE_004</span><span class="status-badge classified" id="badge-marble">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Marble Face</h3>
          <p class="file-desc">Forty-seven covers. Full occupancy. The subject's resting expression under operational pressure. Controlled presentation as neurological armour. What is displayed is not what is felt. Format: Orchestral Grime, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-marble">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-marble">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-marble">RESTRICTED — LEVEL 1</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-marble">⌇ LOCKED</span>
          <audio id="player-marble" preload="metadata" src="MCenotaph_MARBLE_FACE.mp3"></audio>
          <div class="player-ui" id="ui-marble" style="display:none;">
            <button class="play-btn" id="play-btn-marble" aria-label="Play Marble Face">
              <span id="play-icon-marble">▶</span>&nbsp; PLAY FILE_004
            </button>
            <div class="progress-wrap" id="progress-wrap-marble">
              <div class="progress-bar" id="progress-bar-marble"></div>
            </div>
            <span class="time-display" id="time-marble">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" id="card-golden" aria-label="File 005 — Classified">
          <div class="file-tag"><span>FILE_005</span><span class="status-badge classified" id="badge-golden">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Golden Decay</h3>
          <p class="file-desc">Rust is the new luxury. The subject documents the oxidation process — when gold loses its surface and what was beneath is finally visible. Corrosion as revelation. Format: Orchestral Neurofunk, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-golden">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-golden">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-golden">RESTRICTED — LEVEL 2</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-golden">⌇ LOCKED</span>
          <audio id="player-golden" preload="metadata" src="MCenotaph_GOLDEN_DECAY.mp3"></audio>
          <div class="player-ui" id="ui-golden" style="display:none;">
            <button class="play-btn" id="play-btn-golden" aria-label="Play Golden Decay">
              <span id="play-icon-golden">▶</span>&nbsp; PLAY FILE_005
            </button>
            <div class="progress-wrap" id="progress-wrap-golden">
              <div class="progress-bar" id="progress-bar-golden"></div>
            </div>
            <span class="time-display" id="time-golden">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" id="card-006" aria-label="File 006 — Classified">
          <div class="file-tag"><span>FILE_006</span><span class="status-badge classified" id="badge-006">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Employee of the Month</h3>
          <p class="file-desc">Commendation document. The subject performed above and beyond. No blood on the whites. Not one drop. The award was presented. The subject smiled. They gave him a frame for it, blud. Format: Dark Liquid DnB, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-006">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-006">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-006">RESTRICTED — LEVEL 2</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-006">⌇ LOCKED</span>
          <audio id="player-006" preload="metadata" src="MCenotaph_EMPLOYEE_OF_THE_MONTH.mp3"></audio>
          <div class="player-ui" id="ui-006" style="display:none;">
            <button class="play-btn" id="play-btn-006" aria-label="Play Employee of the Month">
              <span id="play-icon-006">▶</span>&nbsp; PLAY FILE_006
            </button>
            <div class="progress-wrap" id="progress-wrap-006">
              <div class="progress-bar" id="progress-bar-006"></div>
            </div>
            <span class="time-display" id="time-006">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" id="card-007" aria-label="File 007 — Classified">
          <div class="file-tag"><span>FILE_007</span><span class="status-badge classified" id="badge-007">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">The Customer Is King</h3>
          <p class="file-desc">But the king is dead, fam. Examination of asymmetric power exchange disguised as service. The subject enumerates the transactions. Nobody calls it what it is. Format: Orchestral Liquid DnB / Grime, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-007">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-007">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-007">RESTRICTED — LEVEL 2</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-007">⌇ LOCKED</span>
          <audio id="player-007" preload="metadata" src="MCenotaph_THE_CUSTOMER_IS_KING.mp3"></audio>
          <div class="player-ui" id="ui-007" style="display:none;">
            <button class="play-btn" id="play-btn-007" aria-label="Play The Customer Is King">
              <span id="play-icon-007">▶</span>&nbsp; PLAY FILE_007
            </button>
            <div class="progress-wrap" id="progress-wrap-007">
              <div class="progress-bar" id="progress-bar-007"></div>
            </div>
            <span class="time-display" id="time-007">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" id="card-008" aria-label="File 008 — Classified">
          <div class="file-tag"><span>FILE_008</span><span class="status-badge classified" id="badge-008">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Pressure Cooker</h3>
          <p class="file-desc">If I crack a seal, the whole building goes. The physics of internal containment. Thermal dynamics of suppressed affect. The subject calculates load-bearing capacity daily. Has not miscalculated. Yet. Format: Neurofunk, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" id="rec-008">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val" id="int-008">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val" id="cls-008">VAULT — LEVEL 3</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" id="lock-008" style="color:var(--gold-dim)">⌇ VAULT ONLY</span>
          <audio id="player-008" preload="metadata" src="MCenotaph_PRESSURE_COOKER.mp3"></audio>
          <div class="player-ui" id="ui-008" style="display:none;">
            <button class="play-btn" id="play-btn-008" aria-label="Play Pressure Cooker">
              <span id="play-icon-008">▶</span>&nbsp; PLAY FILE_008
            </button>
            <div class="progress-wrap" id="progress-wrap-008">
              <div class="progress-bar" id="progress-bar-008"></div>
            </div>
            <span class="time-display" id="time-008">00:00</span>
          </div>
        </article>

        <article class="archive-item locked" aria-label="File 009 — Classified">
          <div class="file-tag"><span>FILE_009</span><span class="status-badge classified">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">Gold Plated Gravity</h3>
          <p class="file-desc">Falling through the floors. Terminal velocity inside an environment engineered to feel like ascending. The subject documents the paradox: the more beautiful the container, the faster the descent. Format: Orchestral Liquid DnB, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val">VAULT — LEVEL 3</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" style="color:var(--gold-dim)">⌇ VAULT ONLY</span>
        </article>

        <article class="archive-item locked" aria-label="File 010 — Classified">
          <div class="file-tag"><span>FILE_010</span><span class="status-badge classified">RESTRICTED</span></div>
          <h3 class="file-name" style="color:var(--ghost);">The Estate of M.</h3>
          <p class="file-desc">Final testament. The subject designates M. bequeaths the architecture. What remains when the architect is gone: the pressure, the symmetry, the silence. This document is the monument. Format: Orchestral Neurofunk, 182 BPM.</p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val">PENDING</span></span>
            <span><span>INTEGRITY</span><span class="val">—</span></span>
            <span><span>CLASSIFICATION</span><span class="val">VAULT — LEVEL 3</span></span>
          </div>
          <div class="file-access-bar"></div>
          <span class="lock-overlay" style="color:var(--gold-dim)">⌇ VAULT ONLY</span>
        </article>

      </div>
    </section>
    <div class="vault-section" id="vault">
      <div class="vault-inner">
        <div class="section-header">
          <span class="section-code">SECTION_02</span>
          <h2 class="section-title">The Vault</h2>
          <div class="section-rule"></div>
          <span class="section-code">AUTH REQUIRED</span>
        </div>

        <div class="vault-terminal" role="form" aria-label="Vault authentication terminal">
          <div class="vault-body">
            <p class="vault-desc">
              <strong>Authorization Protocol:</strong> The vault does not distribute keys.
              The key is embedded inside the work itself — in the silence between the notes,
              in the condition the music was composed inside.<br/><br/>
              Those who listen closely enough will find it. Those who do not
              are not authorized. This is not a barrier. It is a filter.
            </p>

            <div class="vault-input-group" id="vault-input-group">
              <span class="vault-prefix">KEY://</span>
              <input
                type="password"
                id="vault-key"
                placeholder="INSERT AUTHORIZATION KEY"
                autocomplete="off"
                spellcheck="false"
                maxlength="32"
                aria-label="Vault authorization key"
              />
              <button id="vault-submit" type="button" aria-label="Submit key">SUBMIT</button>
            </div>
            <p id="vault-response" aria-live="polite"></p>

            <div class="vault-hint">
              <span style="color:var(--ghost); letter-spacing:0.15em;">AUTHORIZATION HINT</span>
              <br/><br/>
              <span class="clue" title="The subject did not scream. The subject counted.">
                The subject did not scream. The subject counted.
              </span>
              <br/><br/>
              <span style="color:var(--dim); font-size:0.58rem; line-height:2.2;">
                In EVIDENCE_A — at the moment the orchestra stops —<br/>
                count four beats of silence.<br/><br/>
                The word that names that silence<br/>
                is the word the subject lived inside for years.<br/><br/>
                It is not written in the lyrics.<br/>
                It is the condition the music was composed inside.<br/><br/>
                <span style="color:var(--muted)">[ The key is a single word. All caps. ]</span>
              </span>
            </div>
            <!-- Vault content (unlocked state) -->
            <div id="vault-content" aria-live="polite">
              <div class="vault-doc-header">
                ▸ VAULT DOCUMENT — CLEARANCE GRANTED — LEVEL 3
              </div>
              <div class="vault-doc-body">
                <h3>M. CENOTAPH — Investment Memorandum</h3>
                <p>
                  M. CENOTAPH is not a music project. It is a content architecture —
                  a narrative universe built around a single structural concept:
                  the monument erected for someone who did not die, but disappeared
                  into the system that employed them.
                </p>
                <p>
                  <strong style="color:var(--bone); font-weight:400;">The Artist.</strong>
                  The subject designated M. spent years operating at the highest
                  level of European luxury service — a position that requires the
                  neurological architecture of a trauma survivor: hypervigilance,
                  compressed threat assessment, anticipatory pattern recognition
                  calibrated to 300ms windows. This is not metaphor. It is
                  measurable. The music at 182 BPM is not arbitrary — it is the
                  precise mean resting heart rate recorded during service at full
                  occupancy. The trauma was the instrument. The instrument was
                  already professional-grade.
                </p>
                <p>
                  <strong style="color:var(--bone); font-weight:400;">The Catalogue.</strong>
                  Three singles in active development: VACUUM SEALED (the compression),
                  SWEET DESCENT (the surrender), ARCHITECT OF VOID (the reconstruction).
                  Each document a distinct psychological state. Each is a standalone
                  release and a chapter in a larger narrative arc.
                  Format: Orchestral Liquid DnB, 182 BPM, featuring dual-voice
                  composition — The Authority (female, RP) and The Architect (male, London Estuary).
                </p>
                <p>
                  <strong style="color:var(--bone); font-weight:400;">The Market.</strong>
                  The overlap between luxury audience and underground electronic music
                  is underserved and high-value: 25–40, high disposable income,
                  anti-mainstream, experience-driven. M. CENOTAPH does not compete
                  in that market. It creates a category: forensic luxury.
                  The aesthetic language of a five-star establishment applied
                  to the documentation of its own violence.
                </p>
                <p>
                  <strong style="color:var(--bone); font-weight:400;">The Architecture.</strong>
                  This site is not a promotional tool. It is the first artifact.
                  The vault system, the boot sequence, the classified file structure —
                  these are not decoration. They are the product. The audience
                  is not consuming content. They are being granted conditional access
                  to an archive. That distinction is the entire brand.
                </p>
                <p style="color:var(--ghost); font-size:0.6rem; margin-top:2rem; border-top:1px solid var(--border-soft); padding-top:1.5rem;">
                  For licensing, investment, or collaboration enquiries:<br/>
                  access is granted by the archive, not by request.<br/>
                  You already know where to find the key.
                </p>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- ============================================================
         FRAGMENT_DREAM — MEMORY PROTOCOL MINIGAME
    ============================================================ -->
    <div id="minigame-section" aria-labelledby="mg-heading">
      <div style="max-width:var(--col-max); margin:0 auto;">
        <div class="section-header">
          <span class="section-code">SECTION_03</span>
          <h2 class="section-title" id="mg-heading">Memory Protocol</h2>
          <div class="section-rule"></div>
          <span class="section-code">FRAGMENT_DREAM</span>
        </div>

        <div class="vault-terminal" id="minigame-terminal" style="max-width:720px;">
          <div class="vault-body">

            <!-- INTRO STATE -->
            <div id="mg-intro">
              <p class="vault-desc">
                <strong>Fragmented signal detected.</strong> The archive holds one final transmission —
                but it is not stored. It is <em>remembered</em>.<br/><br/>
                The system will flash a sequence of cells. Memorise the pattern.
                Reproduce it exactly. Each fragment adds a cell to the sequence.<br/><br/>
                Reach <strong style="color:var(--bone)">Level 6</strong> — starting from Level 4 to recover
                <strong style="color:var(--accent)">FRAGMENT_DREAM</strong>.
                One mistake ends the protocol.
              </p>
              <button id="mg-start-btn" class="play-btn" style="width:auto; margin-top:1rem; pointer-events:all;">
                ▶&nbsp; INITIATE MEMORY PROTOCOL
              </button>
            </div>

            <!-- GAME STATE -->
            <div id="mg-game" style="display:none;">
              <div id="mg-hud">
                <span id="mg-level-display">LEVEL 01 / 10</span>
                <span id="mg-phase-display">MEMORISE</span>
              </div>

              <!-- Grid — 4×4 cells -->
              <div id="mg-grid" role="grid" aria-label="Memory grid"></div>

              <div id="mg-message"></div>

              <button id="mg-confirm-btn" class="play-btn" style="width:auto; display:none; pointer-events:all;">
                ✓&nbsp; CONFIRM SEQUENCE
              </button>
            </div>

            <!-- WIN STATE -->
            <div id="minigame-win" style="display:none;">
              <div id="mg-win-headline">▸ MEMORY PROTOCOL COMPLETE</div>
              <div id="mg-win-quote">"The void is not empty. It is a masterpiece."</div>
              <div id="mg-win-sub">FRAGMENT_DREAM — RECOVERED FROM THE ARCHITECTURE OF LOSS</div>
              <audio id="player-fragment" preload="metadata" src="MCenotaph_FRAGMENTED_DREAM.mp3"></audio>
              <div class="player-ui" id="ui-fragment" style="pointer-events:all; display:flex; margin-top:1.4rem;">
                <button class="play-btn" id="play-btn-fragment" style="pointer-events:all;">
                  <span id="play-icon-fragment">▶</span>&nbsp; PLAY FRAGMENT_DREAM
                </button>
                <div class="progress-wrap" id="progress-wrap-fragment" style="pointer-events:all;">
                  <div class="progress-bar" id="progress-bar-fragment"></div>
                </div>
                <span class="time-display" id="time-fragment">00:00</span>
              </div>
            </div>

            <!-- FAIL STATE -->
            <div id="mg-fail" style="display:none;">
              <div id="mg-fail-headline">▸ PROTOCOL INTERRUPTED</div>
              <div id="mg-fail-sub">The fragment dissolves. Memory failed at Level <span id="mg-fail-level">—</span>.</div>
              <button id="mg-retry-btn" class="play-btn" style="width:auto; margin-top:1.2rem; pointer-events:all;">
                ↺&nbsp; RESTART PROTOCOL
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- ============================================================
         SIGNAL SCAN — COLD_OPTICS MINIGAME
    ============================================================ -->
    <div id="signal-scan-section" aria-labelledby="ss-heading">
      <div style="max-width:var(--col-max); margin:0 auto;">
        <div class="section-header">
          <span class="section-code">SECTION_04</span>
          <h2 class="section-title" id="ss-heading">Signal Scan</h2>
          <div class="section-rule"></div>
          <span class="section-code">COLD_OPTICS</span>
        </div>

        <div class="vault-terminal" id="signal-scan-terminal" style="max-width:720px;">
          <div class="vault-body">

            <!-- INTRO STATE -->
            <div id="ss-intro">
              <p class="vault-desc">
                <strong>Transmission intercepted.</strong> A cold signal drifts through the static —
                precise, distant, undetected by automated systems.<br/><br/>
                Tune the frequency dial. Find the exact carrier wave hidden inside the interference.
                Hold the lock steady for <strong style="color:var(--bone)">2 seconds</strong>
                to confirm acquisition and recover
                <strong style="color:#00d4e8;">COLD_OPTICS</strong>.
              </p>
              <button id="ss-start-btn" class="play-btn" style="width:auto; margin-top:1rem; pointer-events:all;">
                ▶&nbsp; INITIATE SIGNAL SCAN
              </button>
            </div>

            <!-- GAME STATE -->
            <div id="ss-game" style="display:none;">
              <div id="ss-hud">
                <span id="ss-freq-display">--- . - MHz</span>
                <span id="ss-status-display">SCANNING</span>
              </div>
              <div id="ss-scope-wrap">
                <canvas id="ss-canvas" width="640" height="80" aria-hidden="true"></canvas>
                <div id="ss-scope-overlay">
                  <span class="ss-scope-label">CH1 · 5mV/div</span>
                  <span class="ss-scope-label" id="ss-scope-mv">~0mV</span>
                </div>
              </div>
              <div id="ss-signal-bars" aria-label="Signal strength indicator">
                <span class="ss-bar-label">SIG</span>
                <div class="ss-bar" id="ss-bar-1"></div>
                <div class="ss-bar" id="ss-bar-2"></div>
                <div class="ss-bar" id="ss-bar-3"></div>
                <div class="ss-bar" id="ss-bar-4"></div>
                <div class="ss-bar" id="ss-bar-5"></div>
                <span id="ss-signal-pct">0%</span>
              </div>
              <div id="ss-tuner-wrap">
                <div id="ss-tuner-track"
                     role="slider"
                     aria-label="Frequency tuner"
                     aria-valuemin="0"
                     aria-valuemax="100"
                     aria-valuenow="50">
                  <div id="ss-tuner-interference"></div>
                  <div id="ss-tuner-needle"></div>
                </div>
                <div id="ss-tuner-labels">
                  <span>88.0</span>
                  <span>93.5</span>
                  <span>99.0</span>
                  <span>104.5</span>
                  <span>108.0</span>
                </div>
              </div>
              <div id="ss-message"></div>
              <div id="ss-hold-wrap" style="display:none;">
                <div id="ss-hold-label">▸ HOLDING LOCK — MAINTAIN POSITION</div>
                <div id="ss-hold-track"><div id="ss-hold-bar"></div></div>
              </div>
            </div><!-- /ss-game -->

            <!-- WIN STATE -->
            <div id="ss-win" style="display:none;">
              <div id="ss-win-headline">▸ SIGNAL ACQUISITION COMPLETE</div>
              <div id="ss-win-quote">"The coldest eye sees furthest."</div>
              <div id="ss-win-sub">COLD_OPTICS — EXTRACTED FROM THE CARRIER WAVE</div>
              <audio id="player-cold" preload="metadata" src="MCenotaph_COLD_OPTICS.mp3"></audio>
              <div class="player-ui" id="ui-cold" style="pointer-events:all; display:flex; margin-top:1.4rem;">
                <button class="play-btn" id="play-btn-cold" style="pointer-events:all; border-color:rgba(0,212,232,0.35); color:#00d4e8;">
                  <span id="play-icon-cold">▶</span>&nbsp; PLAY COLD_OPTICS
                </button>
                <div class="progress-wrap" id="progress-wrap-cold" style="pointer-events:all;">
                  <div class="progress-bar" id="progress-bar-cold" style="background:#00d4e8;"></div>
                </div>
                <span class="time-display" id="time-cold">00:00</span>
              </div>
            </div>

          </div><!-- /vault-body -->
        </div><!-- /vault-terminal -->
      </div>
    </div>

    <!-- ============================================================
         GLASS TEARS — STATIC WEEP MINIGAME
    ============================================================ -->
    <div id="glass-tears-section" aria-labelledby="gt-heading">
      <div style="max-width:var(--col-max); margin:0 auto;">
        <div class="section-header">
          <span class="section-code">SECTION_05</span>
          <h2 class="section-title" id="gt-heading">Glass Tears</h2>
          <div class="section-rule"></div>
          <span class="section-code">STATIC_WEEP</span>
        </div>

        <div class="vault-terminal" id="gt-terminal">
          <div class="vault-body">

            <!-- INTRO -->
            <div id="gt-intro">
              <p class="vault-desc">
                <strong>Signal fragmentation detected.</strong> The transmission is breaking apart —
                data dissolving into static, falling like shards through corrupted memory.<br/><br/>
                Intercept the <strong style="color:#a8d8ff;">blue tears</strong> before they vanish.
                Avoid the <strong style="color:var(--danger);">red static</strong> — it corrupts the signal.
                Three errors and the channel is lost.<br/><br/>
                Capture <strong style="color:var(--bone);">15 fragments</strong> to reconstruct
                <strong style="color:#a8d8ff;">GLASS_TEARS</strong>.
              </p>
              <button id="gt-start-btn" class="play-btn" style="width:auto; margin-top:1rem; pointer-events:all;">
                ▶&nbsp; INTERCEPT SIGNAL
              </button>
            </div>

            <!-- GAME -->
            <div id="gt-game" style="display:none;">

              <div id="gt-hud">
                <div id="gt-lives">
                  <span style="font-size:0.5rem;letter-spacing:0.15em;color:var(--dim);margin-right:0.4rem;">INTEGRITY</span>
                  <span class="gt-life" id="gt-life-1"></span>
                  <span class="gt-life" id="gt-life-2"></span>
                  <span class="gt-life" id="gt-life-3"></span>
                </div>
                <span id="gt-counter-label">CAPTURED &nbsp;<span id="gt-counter">00 / 15</span></span>
                <span id="gt-wave-label">WAVE <span id="gt-wave-num">01</span></span>
              </div>

              <div id="gt-canvas-wrap">
                <canvas id="gt-canvas" width="760" height="200" aria-hidden="true"></canvas>
              </div>

              <div id="gt-message">▸ TEARS INCOMING — INTERCEPT NOW</div>

            </div><!-- /gt-game -->

            <!-- WIN -->
            <div id="gt-win" style="display:none;">
              <div id="gt-win-headline">▸ SIGNAL RECONSTRUCTION COMPLETE</div>
              <div id="gt-win-quote">"Every fracture holds a frequency."</div>
              <div id="gt-win-sub">GLASS_TEARS — RECOVERED FROM THE FALLING STATIC</div>
              <audio id="player-glass" preload="metadata" src="MCenotaph_GLASS_TEARS.mp3"></audio>
              <div class="player-ui" id="ui-glass" style="pointer-events:all; display:flex; margin-top:1.4rem;">
                <button class="play-btn" id="play-btn-glass" style="pointer-events:all; border-color:rgba(168,216,255,0.3); color:#a8d8ff;">
                  <span id="play-icon-glass">▶</span>&nbsp; PLAY GLASS_TEARS
                </button>
                <div class="progress-wrap" id="progress-wrap-glass" style="pointer-events:all;">
                  <div class="progress-bar" id="progress-bar-glass" style="background:#a8d8ff;"></div>
                </div>
                <span class="time-display" id="time-glass">00:00</span>
              </div>
            </div>

            <!-- FAIL -->
            <div id="gt-fail" style="display:none;">
              <div id="gt-fail-headline">▸ SIGNAL LOST — STATIC CONSUMED THE CHANNEL</div>
              <p class="vault-desc" style="margin-bottom:1.2rem;">The tears dissolve. Integrity at zero. Attempt recovery.</p>
              <button id="gt-retry-btn" class="play-btn" style="width:auto; pointer-events:all;">
                ↺&nbsp; RETRY INTERCEPTION
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer>
      <div class="footer-left">
        M. CENOTAPH — DIGITAL NECROPOLIS<br/>
        Archive Status: PARTIAL RECOVERY<br/>
        © The Estate of M. — All Rights Withheld
      </div>
      <div class="footer-right">
        This archive is not public property.<br/>
        Your access has been logged.<br/>
        <span style="color: var(--dim)">Session ID: <span id="session-id"></span></span>
      </div>
    </footer>

  </div><!-- /main-content -->

  <!-- ============================================================
       JAVASCRIPT
  ============================================================ -->
  <script>
    'use strict';

    /* ── Utilities ───────────────────────────────────────────── */
    const delay = ms => new Promise(res => setTimeout(res, ms));
    const qs    = sel => document.querySelector(sel);
    const rand  = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;

    /* ── Session ID ──────────────────────────────────────────── */
    const sessionId = [...Array(16)].map(() =>
      Math.floor(Math.random() * 16).toString(16)).join('').toUpperCase();
    qs('#session-id').textContent = sessionId;

    /* ── fmt helper ─────────────────────────────────────────── */
    function fmt(s) {
      if (isNaN(s)) return '00:00';
      const m = Math.floor(s / 60);
      const sec = Math.floor(s % 60);
      return String(m).padStart(2,'0') + ':' + String(sec).padStart(2,'0');
    }

    /* ============================================================
       INTEGRITY BAR — 12 slots, each = 8.33%
       Starts at 16.6% (2 unlocked by default)
    ============================================================ */
    const TOTAL_FILES  = 10;  // 2 default + 5 vault + 3 minigames
    const SLOT_PCT     = 100 / TOTAL_FILES; // 10%

    // Track unlocked count (2 default = Vacuum + Sweet Descent)
    let unlockedCount = 2;

    function updateIntegrityBar(count) {
      const bar = qs('#integrity-bar-fill');
      if (!bar) return;
      const pct = Math.min(100, count * SLOT_PCT);
      bar.style.width = pct + '%';

      // Colour progression
      bar.className = '';
      if (pct >= 100)      bar.classList.add('full');
      else if (pct >= 60)  bar.classList.add('high');
      else if (pct >= 33)  bar.classList.add('mid');

      // If full — trigger Gold Mode after delay
      if (pct >= 100) triggerGoldMode(true);
    }

    // Initialise bar
    updateIntegrityBar(unlockedCount);

    /* ============================================================
       SYS_STATUS ENGINE
    ============================================================ */
    const SYS = {
      played001:    false,
      playedA:      false,
      playedLog:    false,
      unlockedFiles: 2,    // vault unlocks add to this
    };

    // Map: vaultCode → { count: files unlocked total, ... }
    const VAULT_CODES = {
      // ── File unlocks ───────────────────────────────────────────
      'ASPHYXIA':  { file: 'FILE_002', title: 'Silk Garrotte',     msg: 'EXECUTING PROTOCOL... SILK GARROTTE RECOVERED.',  cardId: 'card-silk',    audioId: 'player-silk',    uiId: 'ui-silk',    lockId: 'lock-silk',    badgeId: 'badge-silk',    recId: 'rec-silk',    intId: 'int-silk',    clsId: 'cls-silk'    },
      'MARBLE':    { file: 'FILE_004', title: 'Marble Face',        msg: 'SURFACE CRACKED. MARBLE FACE RECOVERED.',         cardId: 'card-marble',  audioId: 'player-marble',  uiId: 'ui-marble',  lockId: 'lock-marble',  badgeId: 'badge-marble',  recId: 'rec-marble',  intId: 'int-marble',  clsId: 'cls-marble'  },
      'DECAY':     { file: 'FILE_005', title: 'Golden Decay',       msg: 'DECAY SEQUENCE INITIATED. OXIDATION CONFIRMED.',  cardId: 'card-golden',  audioId: 'player-golden',  uiId: 'ui-golden',  lockId: 'lock-golden',  badgeId: 'badge-golden',  recId: 'rec-golden',  intId: 'int-golden',  clsId: 'cls-golden'  },
      'BLUEPRINT': { file: 'ARCHIVE_LOG', title: 'Architect of Void', msg: 'IDENTITY CONFIRMED. WELCOME, MAKER.',           cardId: 'archive-log-card', audioId: 'player-archive-log', uiId: 'player-ui-log', lockId: 'archive-log-lock', badgeId: 'archive-log-badge', recId: 'archive-log-recovered', intId: 'archive-log-integrity', clsId: 'archive-log-class' },
      'PHANTOM':   { file: 'FILE_003', title: 'Ghost Protocol',    msg: 'TRACE ERASED. GHOST PROTOCOL RECOVERED.',          cardId: 'card-ghost',   audioId: 'player-ghost',   uiId: 'ui-ghost',   lockId: 'lock-ghost',   badgeId: 'badge-ghost',   recId: 'rec-ghost',   intId: 'int-ghost',   clsId: 'cls-ghost'   },
    };

    // ── Gold Mode exclusive codes ─────────────────────────────
    const GOLD_CODES = {
      'COMMENDED':  { file: 'FILE_006', title: 'Employee of the Month', msg: 'COMMENDATION AUTHENTICATED. EMPLOYEE OF THE MONTH RECOVERED.',  cardId: 'card-006', audioId: 'player-006', uiId: 'ui-006', lockId: 'lock-006', badgeId: 'badge-006', recId: 'rec-006', intId: 'int-006', clsId: 'cls-006' },
      'SOVEREIGN':  { file: 'FILE_007', title: 'The Customer Is King',  msg: 'CROWN ACKNOWLEDGED. THE CUSTOMER IS KING RECOVERED.',           cardId: 'card-007', audioId: 'player-007', uiId: 'ui-007', lockId: 'lock-007', badgeId: 'badge-007', recId: 'rec-007', intId: 'int-007', clsId: 'cls-007' },
      'THRESHOLD':  { file: 'FILE_008', title: 'Pressure Cooker',       msg: 'SEAL INTEGRITY CONFIRMED. PRESSURE COOKER RECOVERED.',          cardId: 'card-008', audioId: 'player-008', uiId: 'ui-008', lockId: 'lock-008', badgeId: 'badge-008', recId: 'rec-008', intId: 'int-008', clsId: 'cls-008' },
    };

    // ── Special codes (no file unlock) ─────────────────────────
    const SPECIAL_CODES = {
      'ALGOR_MORTIS': { msg: 'GOD PROTOCOL — OMNISCIENT ACCESS GRANTED. ALL FILES DECRYPTED.', action: 'godmode' },
      'GOLDMODE':     { msg: 'GOLD PROTOCOL ACTIVE. AESTHETIC OVERRIDE ENGAGED.', action: 'goldmode' },
      'NECROSIS':     { msg: 'SYSTEM INTEGRITY COMPROMISED.', action: 'necrosis'  },
      'ORCHESTRA':    { msg: 'TRANSMISSION INITIATED.', action: 'orchestra' },
      'EPIGRAFE':     { msg: 'INSCRIPTION RECOGNIZED. NEURO-LINK BYPASSED. ENTERING ARCHIVE.', action: 'skip_intro' },
    };

    const usedCodes = new Set();

    function animateVal(el, newText, color) {
      if (!el) return;
      el.style.opacity = '0';
      setTimeout(() => {
        el.textContent = newText;
        if (color) el.style.color = color;
        el.style.transition = 'opacity 0.4s ease';
        el.style.opacity = '1';
      }, 300);
    }

    function updateSysStatus() {
      const total = SYS.unlockedFiles;
      const allPlayed = SYS.played001 && SYS.playedA && SYS.playedLog;

      animateVal(qs('#sys-files'), `${String(total).padStart(2,'0')} / 10`);
      animateVal(qs('#sys-integrity'), Math.min(100, (total / 10 * 100)).toFixed(1) + '%',
        total >= 10 ? '#ffd700' : total >= 6 ? 'var(--accent-hot)' : total >= 3 ? 'var(--gold)' : 'var(--ash)');

      if (total >= 10) {
        animateVal(qs('#sys-access'), 'MAXIMUM — LEVEL 3', 'var(--accent-hot)');
        animateVal(qs('#sys-subject'), 'ARCHITECT', '#ffd700');
      } else if (total >= 3) {
        animateVal(qs('#sys-access'), 'ELEVATED — LEVEL 2', 'var(--gold)');
        animateVal(qs('#sys-subject'), 'AUTHORIZED', 'var(--gold)');
      } else if (SYS.played001 || SYS.playedA) {
        animateVal(qs('#sys-access'), 'CONDITIONAL+', 'var(--ash)');
        animateVal(qs('#sys-subject'), SYS.played001 && SYS.playedA ? 'PATTERN FORMING' : 'DETECTED', 'var(--ash)');
      }

      if (total >= 3) {
        const v = qs('#sys-vault');
        if (v) { animateVal(v, 'ACTIVE', 'var(--accent-hot)'); v.classList.remove('locked'); }
      }

      // Breach timestamp — first vault unlock
      const br = qs('#sys-breach');
      if (br && br.textContent === '—' && total > 2) {
        const now = new Date();
        animateVal(br, now.toISOString().slice(0,10).replace(/-/g,'.') + ' ' + now.toTimeString().slice(0,5), 'var(--danger)');
      }

      updateIntegrityBar(total);

      if (allPlayed && total >= 3) triggerHiddenMission();
    }

    /* ── Vault unlock card helper ────────────────────────────── */
    function unlockCard(code) {
      const cfg = VAULT_CODES[code];
      if (!cfg) return;

      const card = qs('#' + cfg.cardId);
      if (!card) return;

      card.classList.remove('locked');
      card.classList.add('has-player');
      card.removeAttribute('tabindex');

      const badge = qs('#' + cfg.badgeId);
      if (badge) { badge.textContent = 'RECOVERED'; badge.className = 'status-badge active'; }

      const lockEl = qs('#' + cfg.lockId);
      if (lockEl) lockEl.style.display = 'none';

      const now = new Date().toISOString().slice(0,10).replace(/-/g,'.');
      const recEl = qs('#' + cfg.recId);
      const intEl = qs('#' + cfg.intId);
      const clsEl = qs('#' + cfg.clsId);
      if (recEl) recEl.textContent = now;
      if (intEl) { intEl.textContent = '100.0%'; intEl.style.color = ''; }
      if (clsEl) clsEl.textContent = 'DECLASSIFIED';

      const audioEl  = qs('#' + cfg.audioId);
      const playerUI = qs('#' + cfg.uiId);
      if (audioEl) audioEl.preload = 'metadata';
      if (playerUI) {
        playerUI.style.display = 'flex';
        playerUI.style.animation = 'fadeInUp 0.6s ease';
      }

      SYS.unlockedFiles++;
      updateSysStatus();

      // Force re-wire after unlock (remove from Set so wirePlayer doesn't skip)
      wiredPlayers.delete(cfg.audioId);
      wirePlayer(cfg.audioId, cfg.uiId);
    }

    /* ── Generic player wiring ───────────────────────────────── */
    const wiredPlayers = new Set();

    /* ── Unlock Gold Mode exclusive card ───────────────────── */
    function unlockGoldCard(code) {
      const cfg = GOLD_CODES[code];
      if (!cfg) return;

      const card  = document.getElementById(cfg.cardId);
      const lock  = document.getElementById(cfg.lockId);
      const badge = document.getElementById(cfg.badgeId);
      const recEl = document.getElementById(cfg.recId);
      const intEl = document.getElementById(cfg.intId);
      const clsEl = document.getElementById(cfg.clsId);
      const ui    = document.getElementById(cfg.uiId);

      if (!card) return;

      card.classList.remove('locked');
      card.classList.add('has-player');
      card.removeAttribute('tabindex');
      card.style.borderColor = 'rgba(255,215,0,0.25)';
      card.style.animation   = 'fadeInUp 0.6s ease';

      if (lock)  { lock.style.opacity = '0'; setTimeout(() => lock.remove(), 400); }
      if (badge) {
        badge.textContent  = 'RECOVERED';
        badge.className    = 'status-badge active';
        badge.style.color  = 'var(--gold)';
        badge.style.borderColor = 'rgba(255,215,0,0.3)';
      }

      const dateStr = new Date().toISOString().slice(0,10).replace(/-/g,'.');
      if (recEl) { recEl.textContent = dateStr; recEl.style.color = 'var(--gold)'; }
      if (intEl) { intEl.textContent = '100.0%';  intEl.style.color = 'var(--gold)'; }
      if (clsEl) { clsEl.textContent = 'GOLD — UNRESTRICTED'; clsEl.style.color = 'var(--gold)'; }

      if (ui) {
        ui.style.display = 'flex';
        wirePlayer(cfg.audioId, cfg.uiId);
      }
    }

    function wirePlayer(audioId, uiId) {
      if (wiredPlayers.has(audioId)) return;
      wiredPlayers.add(audioId);

      const audio = document.getElementById(audioId);
      if (!audio) return;

      const ui = document.getElementById(uiId);
      if (!ui) { console.warn('[MCenotaph] wirePlayer: ui not found', uiId); return; }

      // Derive element IDs from naming convention (player-X → play-btn-X etc)
      const suffix = audioId.replace('player-', '');
      const btnId  = 'play-btn-' + suffix;
      const iconId = 'play-icon-' + suffix;
      const barId  = 'progress-bar-' + suffix;
      const wrapId = 'progress-wrap-' + suffix;
      const timeId = 'time-' + suffix;

      const btn  = document.getElementById(btnId);
      const icon = document.getElementById(iconId);
      const bar  = document.getElementById(barId);
      const wrap = document.getElementById(wrapId);
      const timeEl = document.getElementById(timeId);

      audio.dataset.playerId = audioId;
      if (btn) btn.dataset.audioId = audioId;

      if (btn) {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          audioPlay(audioId, btnId, iconId);
        });
      }

      if (wrap) {
        wrap.addEventListener('click', e => {
          e.stopPropagation();
          audioSeekById(e, audioId, wrapId);
        });
        wrap.addEventListener('touchend', e => {
          e.preventDefault();
          audioSeekById(e, audioId, wrapId);
        });
      }

      audio.addEventListener('timeupdate', () => {
        if (!audio.duration) return;
        const pct = (audio.currentTime / audio.duration) * 100;
        if (bar) bar.style.width = pct + '%';
        if (timeEl) timeEl.textContent = fmt(audio.currentTime) + ' / ' + fmt(audio.duration);
      });

      audio.addEventListener('ended', () => {
        if (icon) icon.textContent = '▶';
        if (btn)  btn.classList.remove('playing');
        if (bar)  bar.style.width = '0%';
        if (timeEl) timeEl.textContent = '00:00';
      });
    }

    /* ── Gold Mode — auto-complete all minigames ─────────────── */
    function goldModeAutoWinMinigames() {

      // ── 1. Memory Protocol ───────────────────────────────────
      const mgIntro = qs('#mg-intro');
      const mgGame  = qs('#mg-game');
      const mgWin   = qs('#minigame-win');
      const mgFail  = qs('#mg-fail');
      if (mgWin) {
        if (mgIntro) mgIntro.style.display = 'none';
        if (mgGame)  mgGame.style.display  = 'none';
        if (mgFail)  mgFail.style.display  = 'none';
        mgWin.style.display = 'block';
        mgWin.style.animation = 'fadeInUp 0.8s ease';
        // Wire fragment player if not yet wired
        const fAudio = qs('#player-fragment');
        const fBtn   = qs('#play-btn-fragment');
        if (fAudio && fBtn && !fBtn.dataset.goldWired) {
          fBtn.dataset.goldWired = '1';
          fBtn.dataset.audioId   = 'player-fragment';
          fAudio.dataset.playerId = 'player-fragment';
          const fIcon = qs('#play-icon-fragment');
          const fBar  = qs('#progress-bar-fragment');
          const fWrap = qs('#progress-wrap-fragment');
          const fTime = qs('#time-fragment');
          fBtn.addEventListener('click', e => {
            e.stopPropagation();
            if (!fAudio.paused) { fAudio.pause(); fIcon.textContent='▶'; fBtn.classList.remove('playing'); }
            else { stopOthers(fAudio); fAudio.play().then(()=>{ fIcon.textContent='■'; fBtn.classList.add('playing'); }).catch(()=>{}); }
          });
          fAudio.addEventListener('timeupdate', () => {
            if (!fAudio.duration) return;
            if (fBar) fBar.style.width = (fAudio.currentTime/fAudio.duration*100)+'%';
            if (fTime) fTime.textContent = fmt(fAudio.currentTime)+' / '+fmt(fAudio.duration);
          });
          fAudio.addEventListener('ended', ()=>{ fIcon.textContent='▶'; fBtn.classList.remove('playing'); if(fBar) fBar.style.width='0%'; });
        }
      }

      // ── 2. Signal Scan ───────────────────────────────────────
      const ssIntro = qs('#ss-intro');
      const ssGame  = qs('#ss-game');
      const ssWin   = qs('#ss-win');
      if (ssWin) {
        if (ssIntro) ssIntro.style.display = 'none';
        if (ssGame)  ssGame.style.display  = 'none';
        ssWin.style.display = 'block';
        ssWin.style.animation = 'fadeInUp 0.8s ease';
        const cAudio = qs('#player-cold');
        const cBtn   = qs('#play-btn-cold');
        if (cAudio && cBtn && !cBtn.dataset.goldWired) {
          cBtn.dataset.goldWired = '1';
          cBtn.dataset.audioId = 'player-cold';
          cAudio.dataset.playerId = 'player-cold';
          const cIcon = qs('#play-icon-cold');
          const cBar  = qs('#progress-bar-cold');
          const cWrap = qs('#progress-wrap-cold');
          const cTime = qs('#time-cold');
          cBtn.addEventListener('click', e => {
            e.stopPropagation();
            if (!cAudio.paused) { cAudio.pause(); cIcon.textContent='▶'; cBtn.classList.remove('playing'); }
            else { stopOthers(cAudio); cAudio.play().then(()=>{ cIcon.textContent='■'; cBtn.classList.add('playing'); }).catch(()=>{}); }
          });
          cAudio.addEventListener('timeupdate', () => {
            if (!cAudio.duration) return;
            if (cBar) cBar.style.width = (cAudio.currentTime/cAudio.duration*100)+'%';
            if (cTime) cTime.textContent = fmt(cAudio.currentTime)+' / '+fmt(cAudio.duration);
          });
          cAudio.addEventListener('ended', ()=>{ cIcon.textContent='▶'; cBtn.classList.remove('playing'); if(cBar) cBar.style.width='0%'; });
        }
      }

      // ── 3. Glass Tears ───────────────────────────────────────
      const gtIntro = qs('#gt-intro');
      const gtGame  = qs('#gt-game');
      const gtWin   = qs('#gt-win');
      const gtFail  = qs('#gt-fail');
      if (gtWin) {
        if (gtIntro) gtIntro.style.display = 'none';
        if (gtGame)  gtGame.style.display  = 'none';
        if (gtFail)  gtFail.style.display  = 'none';
        gtWin.style.display = 'block';
        gtWin.style.animation = 'fadeInUp 0.8s ease';
        const gAudio = qs('#player-glass');
        const gBtn   = qs('#play-btn-glass');
        if (gAudio && gBtn && !gBtn.dataset.goldWired) {
          gBtn.dataset.goldWired = '1';
          gBtn.dataset.audioId = 'player-glass';
          gAudio.dataset.playerId = 'player-glass';
          const gIcon = qs('#play-icon-glass');
          const gBar  = qs('#progress-bar-glass');
          const gWrap = qs('#progress-wrap-glass');
          const gTime = qs('#time-glass');
          gBtn.addEventListener('click', e => {
            e.stopPropagation();
            if (!gAudio.paused) { gAudio.pause(); gIcon.textContent='▶'; gBtn.classList.remove('playing'); }
            else { stopOthers(gAudio); gAudio.play().then(()=>{ gIcon.textContent='■'; gBtn.classList.add('playing'); }).catch(()=>{}); }
          });
          gAudio.addEventListener('timeupdate', () => {
            if (!gAudio.duration) return;
            if (gBar) gBar.style.width = (gAudio.currentTime/gAudio.duration*100)+'%';
            if (gTime) gTime.textContent = fmt(gAudio.currentTime)+' / '+fmt(gAudio.duration);
          });
          gAudio.addEventListener('ended', ()=>{ gIcon.textContent='▶'; gBtn.classList.remove('playing'); if(gBar) gBar.style.width='0%'; });
        }
      }

      // Bump SYS counter for newly won games
      if (typeof SYS !== 'undefined') {
        SYS.unlockedFiles = 10; // all files unlocked
        updateSysStatus();
      }
    }

    /* ── Gold Mode ───────────────────────────────────────────── */
    let goldTriggered = false;
    async function triggerGoldMode(addLegacy = false) {
      if (goldTriggered) return;
      goldTriggered = true;

      await delay(1000);
      document.body.classList.add('gold-mode');

      // Auto-complete all minigames
      goldModeAutoWinMinigames();
      const grid = qs('.archive-grid');
      if (!addLegacy) { launchFireworks(); return; }
      if (grid) {
        const legacy = document.createElement('article');
        legacy.className = 'archive-item has-player';
        legacy.id = 'card-legacy';
        legacy.style.cssText = 'border: 1px solid var(--gold); animation: fadeInUp 0.8s ease;';
        legacy.innerHTML = `
          <div class="file-tag">
            <span style="color:var(--gold)">FILE_RESTORED</span>
            <span class="status-badge active" style="color:var(--gold); border-color:rgba(255,215,0,0.4)">THE LEGACY</span>
          </div>
          <h3 class="file-name" style="color:#ffd700;">The Legacy</h3>
          <p class="file-desc" style="color:var(--ash);">
            Archive complete. The monument stands. The subject designated M. has been
            fully recovered — not as a body, but as an architecture. This is the bonus
            transmission. It was always here. You had to earn it.
          </p>
          <div class="file-meta">
            <span><span>RECOVERED</span><span class="val" style="color:var(--gold)">NOW</span></span>
            <span><span>INTEGRITY</span><span class="val" style="color:var(--gold)">100.0%</span></span>
            <span><span>CLASSIFICATION</span><span class="val" style="color:var(--gold)">LEGACY — UNRESTRICTED</span></span>
          </div>
          <div class="file-access-bar"></div>
          <audio id="player-legacy" preload="metadata" src="MCenotaph_THE_LEGACY.mp3"></audio>
          <div class="player-ui" id="ui-legacy">
            <button class="play-btn" id="play-btn-legacy" style="color:var(--gold); border-color:rgba(255,215,0,0.3)">
              <span id="play-icon-legacy">▶</span>&nbsp; PLAY THE LEGACY
            </button>
            <div class="progress-wrap" id="progress-wrap-legacy">
              <div class="progress-bar" id="progress-bar-legacy" style="background:var(--gold)"></div>
            </div>
            <span class="time-display" id="time-legacy">00:00</span>
          </div>
        `;
        grid.appendChild(legacy);
        initLegacyPlayer();
      }

      // ── FIREWORKS ──────────────────────────────────────────
      launchFireworks();

      // Mission complete toast
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        z-index: 9100; font-family: var(--font-mono); font-size: 0.72rem;
        letter-spacing: 0.25em; color: #ffd700; background: rgba(10,8,0,0.9);
        border: 1px solid rgba(255,215,0,0.6); padding: 1.6rem 3rem;
        opacity: 0; transition: opacity 1.2s ease; text-align: center;
        white-space: nowrap; pointer-events: none;
        box-shadow: 0 0 60px rgba(255,215,0,0.15);
      `;
      toast.innerHTML = `&gt; ARCHIVE COMPLETE<br/><span style="color:var(--ghost);font-size:0.52rem;letter-spacing:0.2em;">&gt; THE LEGACY RESTORED — GOLD MODE ACTIVE</span>`;
      document.body.appendChild(toast);
      await delay(100);
      toast.style.opacity = '1';
      await delay(10000);
      toast.style.opacity = '0';
      await delay(1200);
      toast.remove();
    }

    /* ============================================================
       FIREWORKS — Auto Gold Mode celebration
    ============================================================ */
    function launchFireworks() {
      const canvas = document.createElement('canvas');
      canvas.style.cssText = 'position:fixed;inset:0;z-index:9050;pointer-events:none;';
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
      document.body.appendChild(canvas);
      const ctx = canvas.getContext('2d');

      const GOLD_COLORS = [
        '#ffd700', '#ffec6e', '#fff0a0', '#ffa500',
        '#ff6b35', '#ff4444', '#a0f0ff', '#c0a0ff', '#ffffff'
      ];

      const particles = [];
      let frame = 0;
      const DURATION = 600; // frames (~10s at 60fps)

      function spawnBurst(x, y) {
        const count = 60 + Math.floor(Math.random() * 60);
        const col = GOLD_COLORS[Math.floor(Math.random() * GOLD_COLORS.length)];
        for (let i = 0; i < count; i++) {
          const angle = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.4;
          const speed = 2 + Math.random() * 7;
          particles.push({
            x, y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            alpha: 1,
            size:  1.2 + Math.random() * 2.5,
            color: Math.random() > 0.3 ? col : '#ffffff',
            decay: 0.013 + Math.random() * 0.012,
            gravity: 0.08 + Math.random() * 0.06,
            trail: []
          });
        }
      }

      // Spawn trailing rockets
      function spawnRocket() {
        const x = canvas.width  * (0.1 + Math.random() * 0.8);
        const y = canvas.height * (0.6 + Math.random() * 0.35);
        const tx = canvas.width  * (0.15 + Math.random() * 0.7);
        const ty = canvas.height * (0.05 + Math.random() * 0.35);
        const steps = 20 + Math.floor(Math.random() * 20);
        const dx = (tx - x) / steps;
        const dy = (ty - y) / steps;
        let step = 0;
        let cx = x, cy = y;
        function rocketStep() {
          if (step >= steps) { spawnBurst(cx, cy); return; }
          // draw rocket trail dot
          ctx.globalAlpha = 0.8;
          ctx.fillStyle = '#ffd700';
          ctx.beginPath(); ctx.arc(cx, cy, 2, 0, Math.PI*2); ctx.fill();
          cx += dx; cy += dy; step++;
          setTimeout(rocketStep, 18);
        }
        rocketStep();
      }

      // Burst schedule — dense and festive
      const schedule = [];
      for (let i = 0; i < DURATION; i++) {
        if (i < 60) {
          // First second: rapid bursts
          if (i % 6 === 0) schedule.push(i);
        } else if (i < 200) {
          if (i % 10 === 0) schedule.push(i);
        } else if (i < 400) {
          if (i % 15 === 0) schedule.push(i);
        } else {
          if (i % 25 === 0) schedule.push(i);
        }
      }

      function tick() {
        frame++;
        ctx.globalAlpha = 0.18;
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;

        // Scheduled bursts
        if (schedule.includes(frame)) {
          const x = canvas.width  * (0.1 + Math.random() * 0.8);
          const y = canvas.height * (0.05 + Math.random() * 0.55);
          spawnBurst(x, y);
          if (frame < 200 && Math.random() > 0.5) spawnRocket();
        }

        // Draw particles
        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.x  += p.vx;
          p.y  += p.vy;
          p.vy += p.gravity;
          p.vx *= 0.98;
          p.alpha -= p.decay;
          if (p.alpha <= 0) { particles.splice(i, 1); continue; }
          ctx.globalAlpha = p.alpha;
          ctx.fillStyle = p.color;
          ctx.shadowColor = p.color;
          ctx.shadowBlur  = 4;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0;
        }

        if (frame < DURATION || particles.length > 0) {
          requestAnimationFrame(tick);
        } else {
          // Fade out canvas then remove
          let alpha = 1;
          const fadeOut = setInterval(() => {
            alpha -= 0.04;
            canvas.style.opacity = String(Math.max(0, alpha));
            if (alpha <= 0) { clearInterval(fadeOut); canvas.remove(); }
          }, 30);
        }
      }

      requestAnimationFrame(tick);

      // Resize handler
      window.addEventListener('resize', () => {
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;
      }, { once: true });
    }

    /* ── Hidden Mission ──────────────────────────────────────── */
    let missionTriggered = false;
    async function triggerHiddenMission() {
      if (missionTriggered) return;
      missionTriggered = true;
      await delay(2000);
      const el = document.createElement('div');
      el.style.cssText = `
        position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%);
        z-index: 500; font-family: var(--font-mono); font-size: 0.58rem;
        letter-spacing: 0.2em; color: var(--accent); background: var(--black);
        border: 1px solid rgba(160,160,255,0.2); padding: 0.8rem 1.6rem;
        opacity: 0; transition: opacity 1s ease; text-align: center;
        pointer-events: none; white-space: nowrap;
      `;
      el.innerHTML = `&gt; SUBJECT PROFILE: COMPLETE<br/><span style="color:var(--ghost);font-size:0.52rem;">&gt; NEW TRANSMISSION INCOMING...</span>`;
      document.body.appendChild(el);
      await delay(100);
      el.style.opacity = '1';
      await delay(8000);
      el.style.opacity = '0';
      await delay(1000);
      el.remove();
    }

    /* ============================================================
       NECROSIS GLITCH — toggle system
    ============================================================ */
    let necrosisActive = false;
    let necrosisSliceEl = null;

    function activateNecrosis() {
      necrosisActive = true;
      document.body.classList.add('necrosis-active');

      // Inject slice overlay if not exists
      if (!necrosisSliceEl) {
        necrosisSliceEl = document.createElement('div');
        necrosisSliceEl.id = 'necrosis-slice';
        necrosisSliceEl.setAttribute('aria-hidden', 'true');
        necrosisSliceEl.style.cssText = `
          position:fixed; inset:0; z-index:9999; pointer-events:none;
          clip-path: polygon(0 20%, 100% 22%, 100% 26%, 0 24%);
          animation: necrosis-slice-anim 0.12s steps(1) infinite;
        `;
        document.body.appendChild(necrosisSliceEl);
      }

      // Toast
      (async () => {
        const t = document.createElement('div');
        t.style.cssText = `position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);z-index:9000;font-family:var(--font-mono);font-size:0.58rem;letter-spacing:0.2em;color:var(--danger);background:#0a0002;border:1px solid rgba(255,68,68,0.3);padding:0.9rem 2rem;opacity:0;transition:opacity 0.8s ease;text-align:center;pointer-events:none;white-space:nowrap;`;
        t.innerHTML = `&gt; SYSTEM INTEGRITY COMPROMISED<br/><span style="color:var(--ghost);font-size:0.5rem;">&gt; ENTER NECROSIS AGAIN TO RESTORE.</span>`;
        document.body.appendChild(t);
        await delay(80); t.style.opacity='1';
        await delay(5000); t.style.opacity='0';
        await delay(800); t.remove();
      })();
    }

    function deactivateNecrosis() {
      necrosisActive = false;
      document.body.classList.remove('necrosis-active');
      if (necrosisSliceEl) { necrosisSliceEl.remove(); necrosisSliceEl = null; }
    }

    /* ============================================================
       ORCHESTRA — toggle ambient track (independent of Gold Mode)
    ============================================================ */
    let orchestraAudio = null;
    let orchestraPlaying = false;
    let orchestraBtnEl = null;

    function orchUpdateBtn() {
      if (!orchestraBtnEl) return;
      orchestraBtnEl.textContent = orchestraPlaying ? '⏸ STOP' : '▶ PLAY';
    }

    function orchestraPlay() {
      if (!orchestraAudio) {
        orchestraAudio = new Audio('MCenotaph_ORCHESTRA.mp3');
        orchestraAudio.loop = true;
      }
      orchestraAudio.volume = 0.7;
      orchestraPlaying = true;
      orchestraAudio.play().then(() => {
        orchUpdateBtn();
      }).catch(e => {
        console.warn('[MCenotaph] orchestra:', e.message);
        orchestraPlaying = false;
        orchUpdateBtn();
      });
    }

    function orchestraStop() {
      if (!orchestraAudio) return;
      orchestraPlaying = false;
      orchestraAudio.pause();
      orchestraAudio.currentTime = 0;
      orchUpdateBtn();
    }

    function toggleOrchestra() {
      if (orchestraPlaying) { orchestraStop(); } else { orchestraPlay(); }
    }

    function injectOrchestraBtn() {
      if (orchestraBtnEl) return; // already injected
      orchestraBtnEl = document.createElement('button');
      orchestraBtnEl.id = 'orchestra-btn';
      orchestraBtnEl.textContent = '▶ PLAY';
      orchestraBtnEl.style.cssText = [
        'display:inline-block',
        'margin-top:0.8rem',
        'background:none',
        'border:1px solid rgba(255,68,68,0.4)',
        'color:var(--danger)',
        'font-family:var(--font-mono)',
        'font-size:0.52rem',
        'letter-spacing:0.15em',
        'padding:0.5rem 1.2rem',
        'cursor:pointer',
        'width:100%',
      ].join(';');
      orchestraBtnEl.addEventListener('click', toggleOrchestra);
      // Inject into vault response area
      const vaultResp = qs('#vault-response');
      if (vaultResp && vaultResp.parentElement) {
        vaultResp.parentElement.insertBefore(orchestraBtnEl, vaultResp.nextSibling);
      } else {
        document.body.appendChild(orchestraBtnEl);
      }
    }

    /* ============================================================
       STARFIELD — visible 00:00–05:00, shooting stars + gold meteors
    ============================================================ */
    (function() {
      const canvas = document.getElementById('starfield-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');

      // ── Check time window ──────────────────────────────────────
      function isNightWindow() {
        const h = new Date().getHours();
        return h >= 0 && h < 5;
      }

      // ── Resize ────────────────────────────────────────────────
      function resize() {
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener('resize', resize);

      // ── Star pool ─────────────────────────────────────────────
      const STAR_COUNT = 320;
      const stars = [];
      for (let i = 0; i < STAR_COUNT; i++) {
        stars.push({
          x:       Math.random(),
          y:       Math.random(),
          r:       0.2 + Math.random() * 1.4,
          alpha:   0.1 + Math.random() * 0.8,
          twinkle: 0.004 + Math.random() * 0.022,
          phase:   Math.random() * Math.PI * 2,
        });
      }

      // ── Shooting stars / meteors ──────────────────────────────
      const shooters = [];

      function spawnShooter() {
        const gold    = document.body.classList.contains('gold-mode');
        const long    = gold ? Math.random() < 0.55 : Math.random() < 0.2;
        const angle   = (12 + Math.random() * 28) * (Math.PI / 180);

        shooters.push({
          x:       Math.random() * 1.3 - 0.15,
          y:       Math.random() * 0.45,
          vx:      0.002 + Math.random() * 0.003,
          vy:      0.0008 + Math.random() * 0.0012,
          life:    0,
          maxLife: gold ? (long ? 160 : 90) : 80,
          tail:    gold ? (long ? 320 : 150) : 110,
          gold,
          long,
        });
      }

      // Sometimes spawn two meteors at once for gold mode drama
      function maybeSpawnCluster() {
        spawnShooter();
        const gold = document.body.classList.contains('gold-mode');
        if (gold && Math.random() < 0.4) {
          setTimeout(spawnShooter, 180 + Math.random() * 400);
        }
      }

      function scheduleShooter() {
        const gold  = document.body.classList.contains('gold-mode');
        const minMs = gold ? 1800  : 4000;
        const maxMs = gold ? 6000  : 14000;
        const wait  = minMs + Math.random() * (maxMs - minMs);
        setTimeout(() => {
          if (isNightWindow() || document.body.classList.contains('gold-mode')) {
            maybeSpawnCluster();
          }
          scheduleShooter();
        }, wait);
      }
      scheduleShooter();

      // ── Render loop ───────────────────────────────────────────
      let frameId;

      function draw() {
        frameId = requestAnimationFrame(draw);

        const W = canvas.width;
        const H = canvas.height;
        const gold = document.body.classList.contains('gold-mode');

        ctx.clearRect(0, 0, W, H);

        // ── Draw fixed stars ────────────────────────────────────
        const now = performance.now() / 1000;
        for (const s of stars) {
          const twinkled = s.alpha * (0.6 + 0.4 * Math.sin(s.phase + now * s.twinkle * 60));
          ctx.beginPath();
          ctx.arc(s.x * W, s.y * H, s.r, 0, Math.PI * 2);

          if (gold) {
            ctx.fillStyle = `rgba(255, ${180 + Math.floor(s.alpha * 40)}, 60, ${twinkled * 0.85})`;
          } else {
            ctx.fillStyle = `rgba(200, 200, 255, ${twinkled})`;
          }
          ctx.fill();
        }

        // ── Draw shooting stars / meteors ───────────────────────
        for (let i = shooters.length - 1; i >= 0; i--) {
          const s = shooters[i];
          s.life++;
          if (s.life > s.maxLife) { shooters.splice(i, 1); continue; }

          const progress  = s.life / s.maxLife;
          const fadeAlpha = progress < 0.15
            ? (progress / 0.15)
            : progress > 0.75
              ? 1 - (progress - 0.75) / 0.25
              : 1;

          const headX = s.x * W + s.vx * s.life * W;
          const headY = s.y * H + s.vy * s.life * H;
          const tailX = headX - (s.tail * s.vx * W);
          const tailY = headY - (s.tail * s.vy * H);

          const grad = ctx.createLinearGradient(tailX, tailY, headX, headY);

          if (s.gold) {
            if (s.long) {
              // Long-tail meteor — richer glow
              grad.addColorStop(0,    `rgba(255, 80, 0, 0)`);
              grad.addColorStop(0.3,  `rgba(255, 140, 0, ${fadeAlpha * 0.3})`);
              grad.addColorStop(0.65, `rgba(255, 200, 40, ${fadeAlpha * 0.7})`);
              grad.addColorStop(1,    `rgba(255, 240, 120, ${fadeAlpha})`);
            } else {
              grad.addColorStop(0,   `rgba(255, 80, 0, 0)`);
              grad.addColorStop(0.5, `rgba(255, 160, 0, ${fadeAlpha * 0.5})`);
              grad.addColorStop(1,   `rgba(255, 220, 60, ${fadeAlpha * 0.9})`);
            }
          } else {
            // Normal shooting star — blue-white
            grad.addColorStop(0,   `rgba(160, 160, 255, 0)`);
            grad.addColorStop(0.4, `rgba(200, 200, 255, ${fadeAlpha * 0.3})`);
            grad.addColorStop(1,   `rgba(240, 240, 255, ${fadeAlpha * 0.9})`);
          }

          ctx.beginPath();
          ctx.moveTo(tailX, tailY);
          ctx.lineTo(headX, headY);
          ctx.strokeStyle = grad;
          ctx.lineWidth   = s.long ? 2.2 : 1.4;
          ctx.lineCap     = 'round';

          if (s.gold && s.long) {
            ctx.shadowColor = 'rgba(255, 120, 0, 0.7)';
            ctx.shadowBlur  = 14;
          } else if (s.gold) {
            ctx.shadowColor = 'rgba(255, 180, 0, 0.5)';
            ctx.shadowBlur  = 8;
          } else {
            ctx.shadowBlur  = 0;
          }

          ctx.stroke();
          ctx.shadowBlur = 0;
        }
      }

      // ── Visibility logic ─────────────────────────────────────
      function checkVisibility() {
        const show = isNightWindow() || document.body.classList.contains('gold-mode');
        if (show) {
          canvas.classList.add('visible');
          if (!frameId) draw();
        } else {
          canvas.classList.remove('visible');
          if (frameId) { cancelAnimationFrame(frameId); frameId = null; }
        }
      }

      // Check every 60 seconds (hour changes) and also when gold mode might toggle
      checkVisibility();
      setInterval(checkVisibility, 60000);

      // Observer for gold-mode class changes
      new MutationObserver(() => checkVisibility())
        .observe(document.body, { attributes: true, attributeFilter: ['class'] });

    })(); // end starfield IIFE

    /* ============================================================
       RANDOM VAULT HINTS
    ============================================================ */
    const HINTS = [
      'Hint: What tightens but never breaks?',
      'Hint: The monument is empty. Who built it?',
      'Hint: Rust is the new luxury.',
      'Hint: Count the silence. Name it.',
      'Hint: The subject did not scream. The subject counted.',
      'Hint: What is the word for controlled collapse?',
      'Hint: Find the four beats where the orchestra holds its breath.',
      'Hint: The condition the music was composed inside.',
    ];

    function injectRandomHint() {
      const hintEl = qs('.vault-hint');
      if (!hintEl) return;
      const pick = HINTS[Math.floor(Math.random() * HINTS.length)];
      const hintLine = document.createElement('div');
      hintLine.style.cssText = 'margin-top:1.2rem; font-size:0.55rem; color:var(--gold-dim); letter-spacing:0.15em; font-style:italic;';
      hintLine.textContent = pick;
      hintEl.appendChild(hintLine);
    }

    injectRandomHint();

    /* ============================================================
       BOOT SEQUENCE
    ============================================================ */
    const bootLog = qs('#boot-log');
    const bootSep = qs('#boot-sep');
    const procBtn = qs('#proceed-btn');

    const bootLines = [
      { text: '> INITIALIZING RECOVERY SYSTEM v2.4.1',                                                                    delay: 250 },
      { text: '> INTEGRITY CHECK...............................',                                                           delay: 700 },
      { text: '> ARCHIVE CORRUPTION DETECTED — PARTIAL RECOVERY IN PROGRESS',                                            delay: 350 },
      { text: '<span class="dim">────────────────────────────────────────────────────</span>',                            delay: 300 },
      { text: '> FILE_001 [Vacuum Sealed]..............<span class="ok">RECOVERED</span>',                               delay: 280 },
      { text: '> EVIDENCE_A [Sweet Descent]............<span class="ok">RECOVERED</span>',                               delay: 280 },
      { text: '> FILE_002 [Silk Garrotte]..............<span style="color:var(--danger)">CORRUPTED — 12.4%</span>',      delay: 280 },
      { text: '> FILE_003 [Ghost Protocol].............<span class="warn">RESTRICTED — KEY ENCRYPTED</span>',                            delay: 260 },
      { text: '> FILE_004 [Marble Face]................<span class="warn">RESTRICTED</span>',                            delay: 260 },
      { text: '> FILE_005 [Golden Decay]...............<span class="warn">RESTRICTED</span>',                            delay: 260 },
      { text: '> FILE_006 [Employee of the Month].....<span class="warn">RESTRICTED — GOLD CLEARANCE</span>',                            delay: 260 },
      { text: '> FILE_007 [The Customer Is King]......<span class="warn">RESTRICTED — GOLD CLEARANCE</span>',                            delay: 260 },
      { text: '> FILE_008 [Pressure Cooker]............<span class="warn">RESTRICTED — GOLD CLEARANCE</span>',                    delay: 260 },
      { text: '> FILE_009 [Gold Plated Gravity]........<span class="warn">VAULT ACCESS ONLY</span>',                    delay: 260 },
      { text: '> FILE_010 [The Estate of M.]...........<span class="warn">VAULT ACCESS ONLY</span>',                    delay: 260 },
      { text: '> ARCHIVE_LOG [Architect of Void].......<span class="warn">CLASSIFIED</span>',                           delay: 280 },
      { text: '<span class="dim">────────────────────────────────────────────────────</span>',                            delay: 300 },
      { text: '> SECTION_03 [Memory Protocol]..........<span class="warn">LOCKED — CLEARANCE REQUIRED</span>',           delay: 260 },
      { text: '> SECTION_04 [Signal Scan]..............<span class="warn">LOCKED — CLEARANCE REQUIRED</span>',           delay: 260 },
      { text: '> SECTION_05 [Glass Tears]..............<span class="warn">LOCKED — CLEARANCE REQUIRED</span>',           delay: 260 },
      { text: '<span class="dim">────────────────────────────────────────────────────</span>',                            delay: 300 },
      { text: '> FILES RECOVERED: 02 / 10',                                                                               delay: 250 },
      { text: '> GOLD CLEARANCE REQUIRED: 03',                                                                             delay: 250 },
      { text: '> MINIGAMES LOCKED: 03',                                                                                   delay: 250 },
      { text: '> VAULT STATUS: SEALED',                                                                                   delay: 250 },
      { text: '> ACCESS LEVEL ASSIGNED: CONDITIONAL',                                                                    delay: 250 },
      { text: '<span class="dim">────────────────────────────────────────────────────</span>',                            delay: 300 },
      { text: '> WARNING: You are not invited. You are authorized.',                                                      delay: 200 },
      { text: '> NEURO-LINK REQUIRED FOR ENTRY.',                                                                         delay: 200 },
    ];

    async function runBoot() {
      for (const item of bootLines) {
        await delay(item.delay);
        const line = document.createElement('span');
        line.className = 'boot-line visible';
        line.innerHTML = item.text;
        bootLog.appendChild(line);
      }
      await delay(400);
      bootSep.classList.add('visible');
      await delay(300);
      procBtn.classList.add('visible');
    }

    runBoot();

    procBtn.addEventListener('click', async () => {
      qs('#boot-screen').classList.add('dismissed');
      await delay(600);
      qs('#neuro-screen').classList.add('active');
      // Start quote rotation
      quoteInterval = setInterval(rotateQuote, 4000);
    });

    /* ============================================================
       NEURO-LINK SCREEN — 69s listen gate
    ============================================================ */
    const REQUIRED_SECONDS = 69;
    let listenedSeconds = 0;
    let accessGranted   = false;

    function grantAccess() {
      if (accessGranted) return;
      accessGranted = true;

      const cd = qs('#neuro-countdown');
      if (cd) { cd.textContent = 'TRANSMISSION COMPLETE'; cd.classList.add('done'); }

      const listenBar = qs('#neuro-listen-bar');
      if (listenBar) { listenBar.style.width = '100%'; listenBar.classList.add('complete'); listenBar.classList.remove('active'); }

      const st = qs('#neuro-status-text');
      if (st) st.textContent = 'NEURO-LINK ESTABLISHED';

      // Show proceed after 1.5s
      setTimeout(() => {
        const ep = qs('#epigrafe-proceed');
        if (ep) ep.classList.add('visible');
      }, 1500);
    }

    // Bypass via vault key
    const neuroKeyInput  = qs('#neuro-key');
    const neuroKeySubmit = qs('#neuro-key-submit');
    const neuroBypassResp = qs('#neuro-bypass-resp');

    function tryNeuroBypass() {
      const val = neuroKeyInput.value.trim().toUpperCase();
      if (!val) return;
      if (VAULT_CODES[val] || SPECIAL_CODES[val]) {
        const isSkip = SPECIAL_CODES[val] && SPECIAL_CODES[val].action === 'skip_intro';
        neuroBypassResp.className = 'neuro-bypass-resp ok';
        neuroBypassResp.textContent = isSkip
          ? '> INSCRIPTION RECOGNIZED — ARCHIVE UNLOCKING'
          : '> KEY RECOGNIZED — BYPASS AUTHORIZED';
        pendingNeuroCode = val;
        setTimeout(isSkip ? skipIntro : grantAccess, isSkip ? 400 : 800);
      } else {
        neuroBypassResp.className = 'neuro-bypass-resp err';
        neuroBypassResp.textContent = '> INVALID KEY — CONTINUE LISTENING';
      }
    }

    async function skipIntro() {
      // Kill audio
      const ea = qs('#epigrafe-audio');
      if (ea && !ea.paused) ea.pause();
      // Dismiss boot + neuro instantly
      qs('#boot-screen').classList.add('dismissed');
      await delay(200);
      qs('#neuro-screen').classList.add('dismissed');
      await delay(500);
      qs('#main-content').classList.add('visible');
    }

    let pendingNeuroCode = null;

    neuroKeySubmit.addEventListener('click', tryNeuroBypass);
    neuroKeyInput.addEventListener('keydown', e => { if (e.key === 'Enter') tryNeuroBypass(); });

    qs('#epigrafe-proceed').addEventListener('click', async () => {
      const ea = qs('#epigrafe-audio');
      if (ea && !ea.paused) ea.pause();
      qs('#neuro-screen').classList.add('dismissed');
      await delay(800);
      qs('#main-content').classList.add('visible');

      // Apply pending bypass
      if (pendingNeuroCode) {
        await delay(500);
        if (VAULT_CODES[pendingNeuroCode]) {
          if (!usedCodes.has(pendingNeuroCode)) {
            usedCodes.add(pendingNeuroCode);
            unlockCard(pendingNeuroCode);
            if (!vaultCont.classList.contains('visible')) vaultCont.classList.add('visible');
          }
        } else if (SPECIAL_CODES[pendingNeuroCode]) {
          if (SPECIAL_CODES[pendingNeuroCode].action === 'godmode') {
            for (const code of ['ASPHYXIA', 'MARBLE', 'DECAY', 'BLUEPRINT', 'PHANTOM']) {
              if (!usedCodes.has(code)) { usedCodes.add(code); unlockCard(code); }
            }
            goldModeAutoWinMinigames();
            for (const code of ['COMMENDED', 'SOVEREIGN', 'THRESHOLD']) {
              if (!usedCodes.has(code)) { usedCodes.add(code); unlockGoldCard(code); }
            }
            if (!goldTriggered) triggerGoldMode();
          }
        }
      }
    });

    /* ============================================================
       RANDOM GLITCH
    ============================================================ */
    const glitchEl = qs('#glitch-distort');

    async function triggerGlitch() {
      glitchEl.style.cssText = `
        opacity: 1;
        background: linear-gradient(
          ${rand(0,360)}deg,
          transparent ${rand(0,40)}%,
          rgba(160,160,255,0.03) ${rand(40,60)}%,
          transparent ${rand(60,100)}%
        );
        transform: translateY(${rand(-3,3)}px) scaleX(${0.998 + Math.random()*0.004});
      `;
      await delay(rand(50, 150));
      glitchEl.style.opacity = '0';
    }

    setInterval(() => { if (Math.random() < 0.3) triggerGlitch(); }, 4000);

    /* ============================================================
       VAULT AUTH — multi-code
    ============================================================ */
    const inputGroup = qs('#vault-input-group');
    const vaultInput = qs('#vault-key');
    const vaultResp  = qs('#vault-response');
    const vaultCont  = qs('#vault-content');
    const submitBtn  = qs('#vault-submit');

    let attempts = 0;

    async function handleVaultSubmit() {
      const val = vaultInput.value.trim().toUpperCase();

      if (!val) {
        vaultResp.className = 'err';
        vaultResp.textContent = '> ERROR: No input detected.';
        return;
      }

      attempts++;

      if (VAULT_CODES[val]) {
        if (usedCodes.has(val)) {
          vaultResp.className = 'ok';
          vaultResp.textContent = `> ${VAULT_CODES[val].file} ALREADY RECOVERED.`;
          return;
        }

        usedCodes.add(val);
        inputGroup.classList.add('success');
        vaultResp.className = 'ok';
        vaultResp.textContent = '> ' + VAULT_CODES[val].msg;

        await delay(1200);
        if (usedCodes.size === 1) vaultCont.classList.add('visible');

        unlockCard(val);

        await delay(1000);
        vaultInput.value = '';
        vaultInput.disabled = false;
        submitBtn.disabled = false;
        inputGroup.classList.remove('success');
        vaultResp.textContent = `> ${VAULT_CODES[val].file} RECOVERED. INSERT NEXT KEY IF AUTHORIZED.`;

      } else if (SPECIAL_CODES[val]) {
        const special = SPECIAL_CODES[val];
        inputGroup.classList.add('success');
        vaultResp.className = 'ok';
        vaultResp.textContent = '> ' + special.msg;

        // Orchestra must start synchronously within user gesture
        if (special.action === 'orchestra') {
          injectOrchestraBtn();
          orchestraPlay(); // synchronous - before any await
        }

        if (special.action === 'goldmode' && !goldTriggered) {
          await delay(600);
          triggerGoldMode();
        } else if (special.action === 'godmode') {
          await delay(600);
          // Unlock all vault files
          for (const code of ['ASPHYXIA', 'MARBLE', 'DECAY', 'BLUEPRINT', 'PHANTOM']) {
            if (!usedCodes.has(code)) { usedCodes.add(code); unlockCard(code); }
          }
          // Auto-win all minigames
          goldModeAutoWinMinigames();
          // Unlock gold-exclusive files
          for (const code of ['COMMENDED', 'SOVEREIGN', 'THRESHOLD']) {
            if (!usedCodes.has(code)) { usedCodes.add(code); unlockGoldCard(code); }
          }
          // Also trigger gold mode visuals
          if (!goldTriggered) { triggerGoldMode(); }

          const toast = document.createElement('div');
          toast.style.cssText = `position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);z-index:9000;font-family:var(--font-mono);font-size:0.6rem;letter-spacing:0.2em;color:var(--accent-hot);background:#000;border:1px solid rgba(160,160,255,0.3);padding:1rem 2rem;opacity:0;transition:opacity 1s ease;text-align:center;white-space:nowrap;pointer-events:none;`;
          toast.innerHTML = `&gt; GOD PROTOCOL ENGAGED — ALL FILES DECRYPTED<br/><span style="color:var(--ghost);font-size:0.52rem;">&gt; OMNISCIENT ACCESS LEVEL. THE ARCHIVE IS YOURS.</span>`;
          document.body.appendChild(toast);
          await delay(100); toast.style.opacity = '1';
          await delay(7000); toast.style.opacity = '0';
          await delay(1000); toast.remove();
        } else if (special.action === 'necrosis') {
          if (!necrosisActive) {
            activateNecrosis();
          } else {
            deactivateNecrosis();
            vaultResp.textContent = '> SYSTEM INTEGRITY RESTORED.';
          }
        } else if (special.action === 'orchestra') {
          // already handled synchronously above
        }

        await delay(1500);
        vaultInput.value = '';
        inputGroup.classList.remove('success');
        vaultInput.disabled = false;
        submitBtn.disabled = false;

      } else if (GOLD_CODES[val]) {
        if (!goldTriggered) {
          inputGroup.classList.add('error');
          vaultResp.className = 'err';
          vaultResp.textContent = '> ACCESS DENIED. GOLD CLEARANCE REQUIRED TO RETRIEVE THIS FILE.';
          await delay(1800);
          vaultInput.value = '';
          inputGroup.classList.remove('error');
          vaultInput.disabled = false;
          submitBtn.disabled = false;
          return;
        }
        const gcfg = GOLD_CODES[val];
        if (usedCodes.has(val)) {
          vaultResp.className = 'ok';
          vaultResp.textContent = `> ${gcfg.file} ALREADY RECOVERED.`;
          return;
        }
        usedCodes.add(val);
        inputGroup.classList.add('success');
        vaultResp.className = 'ok';
        vaultResp.textContent = '> ' + gcfg.msg;
        await delay(1200);
        unlockGoldCard(val);
        await delay(1000);
        vaultInput.value = '';
        vaultInput.disabled = false;
        submitBtn.disabled = false;
        inputGroup.classList.remove('success');
        vaultResp.textContent = `> ${gcfg.file} RECOVERED. INSERT NEXT KEY IF AUTHORIZED.`;

      } else {
        inputGroup.classList.add('error');
        vaultResp.className = 'err';

        const msgs = [
          '> AUTHORIZATION FAILED. This incident has been logged.',
          '> INCORRECT KEY. The archive does not negotiate.',
          '> ACCESS DENIED. Return when you are ready.',
          `> ATTEMPT ${attempts}: You are not authorized. The key is embedded in the work.`,
          '> SYSTEM NOTE: Only the correct key will unlock. Persistence is not authorization.',
        ];
        vaultResp.textContent = msgs[Math.min(attempts - 1, msgs.length - 1)];
        setTimeout(() => inputGroup.classList.remove('error'), 500);
      }
    }

    submitBtn.addEventListener('click', handleVaultSubmit);
    vaultInput.addEventListener('keydown', e => { if (e.key === 'Enter') handleVaultSubmit(); });

    /* ============================================================
       INTERSECTION OBSERVER — entrance animations
    ============================================================ */
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.archive-item:not(.has-player)').forEach((el, i) => {
      el.style.cssText = `opacity:0;transform:translateY(20px);transition:opacity 0.7s ease ${i*0.1}s,transform 0.7s ease ${i*0.1}s;`;
      observer.observe(el);
    });

    /* ============================================================
       QUOTE ROTATOR
    ============================================================ */
    const quotes = document.querySelectorAll('.epigrafe-quote');
    let currentQuote = 0;
    let quoteInterval = null;

    function rotateQuote() {
      quotes[currentQuote].classList.remove('active');
      currentQuote = (currentQuote + 1) % quotes.length;
      quotes[currentQuote].classList.add('active');
    }

    /* ============================================================
       EPIGRAFE / INTRO AUDIO
    ============================================================ */
    const _eAudio   = document.getElementById('epigrafe-audio');
    const _eIcon    = document.getElementById('epigrafe-icon');
    const _ePlayBtn = document.getElementById('epigrafe-play-btn');
    const _eBar     = document.getElementById('epigrafe-progress-bar');
    const _eProgress= document.getElementById('epigrafe-progress');
    const _eTime    = document.getElementById('epigrafe-time');

    function toggleEpigrafe() {
      if (!_eAudio) return;
      if (!_eAudio.paused) {
        _eAudio.pause();
        _eIcon.textContent = '▶';
        _ePlayBtn.classList.remove('playing');
      } else {
        _eAudio.play().then(() => {
          _eIcon.textContent = '■';
          _ePlayBtn.classList.add('playing');
        }).catch(e => console.warn('[MCenotaph] intro:', e.message));
      }
    }

    function seekEpigrafe(e) {
      if (!_eAudio || !_eAudio.duration) return;
      const rect = _eProgress.getBoundingClientRect();
      const pct  = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
      _eAudio.currentTime = pct * _eAudio.duration;
    }

    if (_eAudio) {
      _eAudio.addEventListener('timeupdate', () => {
        if (!_eAudio.duration) return;
        const pct = (_eAudio.currentTime / _eAudio.duration) * 100;
        _eBar.style.width = pct + '%';
        _eTime.textContent = fmt(_eAudio.currentTime) + ' / ' + fmt(_eAudio.duration);

        // Count listened seconds (only while actually playing)
        if (!_eAudio.paused) {
          listenedSeconds = _eAudio.currentTime;
          const listenPct = Math.min(100, (listenedSeconds / REQUIRED_SECONDS) * 100);
          const lb = qs('#neuro-listen-bar');
          if (lb) {
            lb.style.width = listenPct + '%';
            if (listenPct > 0 && listenPct < 100) lb.classList.add('active');
          }

          // Update countdown
          const cd = qs('#neuro-countdown');
          if (cd && !accessGranted) {
            const rem = Math.max(0, Math.ceil(REQUIRED_SECONDS - listenedSeconds));
            cd.textContent = rem > 0 ? `${rem}s required` : 'TRANSMISSION COMPLETE';
          }

          if (listenedSeconds >= REQUIRED_SECONDS && !accessGranted) {
            grantAccess();
          }
        }
      });

      _eAudio.addEventListener('ended', () => {
        _eIcon.textContent = '▶';
        _ePlayBtn.classList.remove('playing');
        grantAccess(); // if track shorter than 69s, still grant
      });
    }

    /* ============================================================
       UNIFIED AUDIO SYSTEM
       All players wired here. No onclick attrs needed.
       Works for visible players AND locked-then-unlocked players.
    ============================================================ */

    // Master play function - simple and reliable
    // Stop all other playing tracks
    function stopOthers(except) {
      document.querySelectorAll('audio').forEach(other => {
        if (other !== except && !other.paused) {
          other.pause();
          const oBtn  = document.querySelector('[data-audio-id="' + other.id + '"]');
          if (oBtn) { oBtn.classList.remove('playing'); const s = oBtn.querySelector('span'); if (s) s.textContent = '▶'; }
        }
      });
    }

    function audioPlay(audioId, btnId, iconId) {
      const audio = document.getElementById(audioId);
      const btn   = document.getElementById(btnId);
      const icon  = document.getElementById(iconId);
      if (!audio) return;

      if (!audio.paused) {
        audio.pause();
        if (icon) icon.textContent = '▶';
        if (btn)  btn.classList.remove('playing');
        return;
      }

      stopOthers(audio);

      // Just play — browser handles buffering. Never call load() as it resets state.
      audio.play().then(() => {
        if (icon) icon.textContent = '■';
        if (btn)  btn.classList.add('playing');
      }).catch(e => console.warn('[MCenotaph]', audioId, e.message));
    }

    function audioSeekById(e, audioId, wrapId) {
      const audio = document.getElementById(audioId);
      const wrap  = document.getElementById(wrapId);
      if (!audio || !audio.duration || !wrap) return;
      const rect = wrap.getBoundingClientRect();
      const x    = (e.touches ? e.touches[0].clientX : e.clientX);
      audio.currentTime = Math.max(0, Math.min(1, (x - rect.left) / rect.width)) * audio.duration;
    }

    function wireAllPlayers() {
      // Config: [audioId, btnId, iconId, barId, wrapId, timeId, sysKey]
      const PLAYERS = [
        ['player-file-001',    'play-btn-001',    'play-icon-001',    'progress-bar-001',    'progress-wrap-001',    'time-001',    'played001'],
        ['player-evidence-a',  'play-btn-a',      'play-icon-a',      'progress-bar-a',      'progress-wrap-a',      'time-a',      'playedA'],
        ['player-archive-log', 'play-btn-log',    'play-icon-log',    'progress-bar-log',    'progress-wrap-log',    'time-log',    'playedLog'],
        ['player-silk',        'play-btn-silk',   'play-icon-silk',   'progress-bar-silk',   'progress-wrap-silk',   'time-silk',   null],
        ['player-marble',      'play-btn-marble', 'play-icon-marble', 'progress-bar-marble', 'progress-wrap-marble', 'time-marble', null],
        ['player-golden',      'play-btn-golden', 'play-icon-golden', 'progress-bar-golden', 'progress-wrap-golden', 'time-golden', null],
        ['player-fragment',    'play-btn-fragment','play-icon-fragment','progress-bar-fragment','progress-wrap-fragment','time-fragment',null],
        ['player-ghost',       'play-btn-ghost',  'play-icon-ghost',  'progress-bar-ghost',  'progress-wrap-ghost',  'time-ghost',  null],
        ['player-006',         'play-btn-006',    'play-icon-006',    'progress-bar-006',    'progress-wrap-006',    'time-006',    null],
        ['player-007',         'play-btn-007',    'play-icon-007',    'progress-bar-007',    'progress-wrap-007',    'time-007',    null],
        ['player-008',         'play-btn-008',    'play-icon-008',    'progress-bar-008',    'progress-wrap-008',    'time-008',    null],
      ];

      PLAYERS.forEach(([audioId, btnId, iconId, barId, wrapId, timeId, sysKey]) => {
        const audio = document.getElementById(audioId);
        const btn   = document.getElementById(btnId);
        const wrap  = document.getElementById(wrapId);
        const bar   = document.getElementById(barId);
        const time  = document.getElementById(timeId);
        const icon  = document.getElementById(iconId);
        if (!audio) return;

        // Skip locked players — wirePlayer handles them on unlock
        const uiParent = btn ? btn.closest('.player-ui') : null;
        if (uiParent && uiParent.style.display === 'none') return;

        // Tag audio for cross-player stop logic
        audio.dataset.playerId = audioId;

        // Play button
        if (btn) {
          btn.dataset.audioId = audioId;  // used by stop-all logic
          btn.addEventListener('click', e => {
            e.stopPropagation();
            audioPlay(audioId, btnId, iconId);
          });
        }

        // Progress seek - mouse and touch
        if (wrap) {
          wrap.addEventListener('click', e => {
            e.stopPropagation();
            audioSeekById(e, audioId, wrapId);
          });
          wrap.addEventListener('touchend', e => {
            e.preventDefault();
            audioSeekById(e, audioId, wrapId);
          });
        }

        // Time progress update
        audio.addEventListener('timeupdate', () => {
          if (!audio.duration) return;
          const pct = (audio.currentTime / audio.duration) * 100;
          if (bar)  bar.style.width = pct + '%';
          if (time) time.textContent = fmt(audio.currentTime) + ' / ' + fmt(audio.duration);
          // SYS tracking for auto-unlock
          if (sysKey && audio.currentTime > 10 && !SYS[sysKey]) {
            SYS[sysKey] = true;
            updateSysStatus();
          }
        });

        audio.addEventListener('ended', () => {
          if (icon) icon.textContent = '▶';
          if (btn)  btn.classList.remove('playing');
          if (bar)  bar.style.width = '0%';
          if (time) time.textContent = '00:00';
        });
      });
    }

    // Wire all players immediately on page load
    wireAllPlayers();

    // Re-wire after vault unlock (for newly shown players)
    // wireAllPlayers is idempotent - duplicate listeners won't double-fire
    // because addEventListener with same function reference deduplicates... 
    // Actually we use anonymous functions so re-wire only for newly revealed players.
    // unlockCard() calls wirePlayer() already which handles this separately.

    /* ============================================================
       LEGACY PLAYER (injected dynamically by Gold Mode)
    ============================================================ */
    function initLegacyPlayer() {
      const _aL    = document.getElementById('player-legacy');
      const _btnL  = document.getElementById('play-btn-legacy');
      const _icoL  = document.getElementById('play-icon-legacy');
      const _barL  = document.getElementById('progress-bar-legacy');
      const _wrapL = document.getElementById('progress-wrap-legacy');
      const _timeL = document.getElementById('time-legacy');

      if (!_aL || !_btnL) return;

      _aL.dataset.playerId  = 'player-legacy';
      _btnL.dataset.audioId = 'player-legacy';

      _btnL.addEventListener('click', e => {
        e.stopPropagation();
        if (!_aL.paused) {
          _aL.pause(); _icoL.textContent = '▶'; _btnL.classList.remove('playing');
        } else {
          stopOthers(_aL);
          _aL.play().then(() => { _icoL.textContent = '■'; _btnL.classList.add('playing'); }).catch(e => console.warn('[MCenotaph] legacy:', e.message));
        }
      });

      if (_wrapL) {
        _wrapL.addEventListener('click', e => {
          e.stopPropagation();
          if (!_aL.duration) return;
          const rect = _wrapL.getBoundingClientRect();
          _aL.currentTime = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width)) * _aL.duration;
        });
        _wrapL.addEventListener('touchend', e => {
          e.preventDefault();
          if (!_aL.duration) return;
          const rect = _wrapL.getBoundingClientRect();
          _aL.currentTime = Math.max(0, Math.min(1, (e.changedTouches[0].clientX - rect.left) / rect.width)) * _aL.duration;
        });
      }

      _aL.addEventListener('timeupdate', () => {
        if (!_aL.duration) return;
        _barL.style.width = (_aL.currentTime / _aL.duration * 100) + '%';
        _timeL.textContent = fmt(_aL.currentTime) + ' / ' + fmt(_aL.duration);
      });
      _aL.addEventListener('ended', () => { _icoL.textContent = '▶'; _btnL.classList.remove('playing'); _barL.style.width = '0%'; _timeL.textContent = '00:00'; });
    }

    /* ============================================================
       MEMORY PROTOCOL — FRAGMENT_DREAM MINIGAME
    ============================================================ */
    (function() {
      const TOTAL_LEVELS = 6;
      const GRID_SIZE    = 16; // 4×4
      const FLASH_ON     = 520;  // ms cell lit
      const FLASH_OFF    = 160;  // ms gap between flashes
      const RECALL_DELAY = 900;  // ms after showing before recall

      let level       = 1;
      let sequence    = [];  // indices of cells in order
      let userInput   = [];
      let phase       = 'idle'; // idle | showing | recall | checking | win | fail
      let locked      = true;

      // DOM
      const intro      = document.getElementById('mg-intro');
      const gameEl     = document.getElementById('mg-game');
      const winEl      = document.getElementById('minigame-win');
      const failEl     = document.getElementById('mg-fail');
      const grid       = document.getElementById('mg-grid');
      const levelDisp  = document.getElementById('mg-level-display');
      const phaseDisp  = document.getElementById('mg-phase-display');
      const msgEl      = document.getElementById('mg-message');
      const confirmBtn = document.getElementById('mg-confirm-btn');
      const startBtn   = document.getElementById('mg-start-btn');
      const retryBtn   = document.getElementById('mg-retry-btn');
      const failLevel  = document.getElementById('mg-fail-level');

      /* ── Build grid ─────────────────────────────────────────── */
      for (let i = 0; i < GRID_SIZE; i++) {
        const cell = document.createElement('div');
        cell.className = 'mg-cell';
        cell.dataset.index = i;
        cell.setAttribute('role', 'button');
        cell.setAttribute('aria-label', `Cell ${i + 1}`);
        cell.addEventListener('click',       () => handleCellClick(i));
        cell.addEventListener('touchend', e  => { e.preventDefault(); handleCellClick(i); });
        grid.appendChild(cell);
      }

      function cells() { return Array.from(grid.querySelectorAll('.mg-cell')); }
      function cell(i) { return grid.querySelector(`.mg-cell[data-index="${i}"]`); }

      /* ── Utility ────────────────────────────────────────────── */
      function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

      function setPhase(p, label) {
        phase = p;
        phaseDisp.textContent = label;
        phaseDisp.className   = p === 'recall' ? 'recall' : '';
      }

      function setMsg(text, cls) {
        msgEl.textContent = text || '';
        msgEl.className   = cls  || '';
      }

      function clearCellClasses() {
        cells().forEach(c => {
          c.classList.remove('flash','selected','correct','wrong','interactive');
          c.style.transitionDelay = '';
        });
      }

      function updateHUD() {
        levelDisp.textContent = `LEVEL ${String(level).padStart(2,'0')} / ${TOTAL_LEVELS}`;
      }

      /* ── Sequence generation ────────────────────────────────── */
      function growSequence() {
        // Add one unique random cell per level (no repeats within a sequence)
        const available = Array.from({length: GRID_SIZE}, (_,i) => i)
          .filter(i => !sequence.includes(i));
        const pick = available[Math.floor(Math.random() * available.length)];
        sequence.push(pick);
      }

      /* ── Show sequence (memorise phase) ────────────────────── */
      async function showSequence() {
        setPhase('showing', 'MEMORISE');
        locked = true;
        clearCellClasses();
        confirmBtn.style.display = 'none';

        // Brief pause before starting
        await sleep(500);

        for (let i = 0; i < sequence.length; i++) {
          const c = cell(sequence[i]);
          c.classList.add('flash');
          await sleep(FLASH_ON);
          c.classList.remove('flash');
          await sleep(FLASH_OFF);
        }

        // Transition to recall
        await sleep(RECALL_DELAY);
        startRecall();
      }

      /* ── Recall phase ───────────────────────────────────────── */
      function startRecall() {
        setPhase('recall', 'RECALL');
        userInput = [];
        locked    = false;
        cells().forEach(c => c.classList.add('interactive'));
        setMsg(`Select ${sequence.length} cell${sequence.length > 1 ? 's' : ''} in order`, '');
        confirmBtn.style.display = 'block';
      }

      /* ── Handle cell click ──────────────────────────────────── */
      // Cheat sequence: bottom row L→R — indices 12, 13, 14, 15
      const CHEAT_SEQ = [12, 13, 14, 15];
      let cheatBuffer = [];

      // Cheat listener fires on ALL cell clicks regardless of phase/lock
      function trackCheat(idx) {
        cheatBuffer.push(idx);
        if (cheatBuffer.length > CHEAT_SEQ.length) cheatBuffer.shift();
        if (cheatBuffer.join(',') === CHEAT_SEQ.join(',')) {
          // Override — force win
          locked = true;
          phase  = 'checking';
          clearCellClasses();
          CHEAT_SEQ.forEach(i => cell(i).classList.add('correct'));
          setMsg('> OVERRIDE ACCEPTED.', 'ok');
          confirmBtn.style.display = 'none';
          setTimeout(triggerWin, 900);
        }
      }

      function handleCellClick(idx) {
        // Always track cheat regardless of game state
        trackCheat(idx);

        if (locked || phase !== 'recall') return;
        if (userInput.includes(idx)) return;
        if (userInput.length >= sequence.length) return;

        userInput.push(idx);
        cell(idx).classList.add('selected');
        setMsg(`${userInput.length} / ${sequence.length} selected`, '');

        if (userInput.length === sequence.length) {
          setTimeout(checkAnswer, 350);
        }
      }

      /* ── Check answer ───────────────────────────────────────── */
      async function checkAnswer() {
        if (phase !== 'recall') return;
        setPhase('checking', 'CHECKING');
        locked = true;
        confirmBtn.style.display = 'none';
        cells().forEach(c => c.classList.remove('interactive'));

        const correct = sequence.every((v, i) => userInput[i] === v);

        if (correct) {
          // Flash correct cells
          sequence.forEach(i => { cell(i).classList.remove('selected'); cell(i).classList.add('correct'); });
          setMsg('> Sequence confirmed.', 'ok');
          await sleep(900);

          if (level >= TOTAL_LEVELS) {
            triggerWin();
          } else {
            level++;
            updateHUD();
            growSequence();
            setMsg('> Next fragment loading...', '');
            await sleep(600);
            showSequence();
          }

        } else {
          // Show wrong cells
          userInput.forEach((v, i) => {
            const c = cell(v);
            c.classList.remove('selected');
            c.classList.add(sequence[i] === v ? 'correct' : 'wrong');
          });
          // Also reveal correct ones not selected
          sequence.forEach(i => {
            if (!userInput.includes(i)) {
              cell(i).classList.add('flash');
            }
          });
          setMsg('> Memory protocol failed. Fragment dissolved.', 'fail');
          await sleep(1800);
          triggerFail();
        }
      }

      /* ── Win ────────────────────────────────────────────────── */
      function triggerWin() {
        phase = 'win';
        gameEl.style.display  = 'none';
        winEl.style.display   = 'block';
        winEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

        // Wire fragment player
        const _fAudio = document.getElementById('player-fragment');
        const _fBtn   = document.getElementById('play-btn-fragment');
        const _fIcon  = document.getElementById('play-icon-fragment');
        const _fBar   = document.getElementById('progress-bar-fragment');
        const _fWrap  = document.getElementById('progress-wrap-fragment');
        const _fTime  = document.getElementById('time-fragment');

        // Fragment player wired by wireAllPlayers() on page load



        // Update SYS panel
        if (typeof SYS !== 'undefined' && typeof updateSysStatus === 'function') {
          SYS.unlockedFiles = (SYS.unlockedFiles || 0) + 1;
          updateSysStatus();
        }
      }

      /* ── Fail ───────────────────────────────────────────────── */
      function triggerFail() {
        phase = 'fail';
        gameEl.style.display  = 'none';
        failEl.style.display  = 'block';
        if (failLevel) failLevel.textContent = level;
      }

      /* ── Start / Restart ────────────────────────────────────── */
      function startGame() {
        level    = 4;
        sequence = [];
        userInput= [];
        phase    = 'idle';

        intro.style.display = 'none';
        failEl.style.display= 'none';
        winEl.style.display = 'none';
        gameEl.style.display= 'block';

        clearCellClasses();

        // Pre-build sequence of 4 random unique cells for level 4 start
        const pool = Array.from({length: GRID_SIZE}, (_, i) => i);
        for (let i = pool.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [pool[i], pool[j]] = [pool[j], pool[i]];
        }
        sequence = pool.slice(0, 4);

        updateHUD();
        showSequence();
      }

      startBtn.addEventListener('click',  startGame);
      retryBtn.addEventListener('click',  startGame);
      confirmBtn.addEventListener('click', () => {
        if (phase === 'recall' && userInput.length > 0) checkAnswer();
      });

    })(); // end memory game IIFE

    /* ============================================================
       SIGNAL SCAN — COLD_OPTICS MINIGAME
    ============================================================ */
    (function() {
      'use strict';

      const LOCK_ZONE  = 0.016;   // ±1.6% of range to trigger lock
      const HOLD_MS    = 2000;    // ms to hold for win
      const FREQ_MIN   = 88.0;
      const FREQ_MAX   = 108.0;

      let targetPos  = 0;
      let currentPos = 0.5;
      let phase      = 'idle';   // idle | scanning | win
      let holdStart  = null;
      let animFrame  = null;
      let timeOrigin = 0;
      let dragging   = false;
      let playerWired = false;

      // DOM refs
      const introEl   = document.getElementById('ss-intro');
      const gameEl    = document.getElementById('ss-game');
      const winEl     = document.getElementById('ss-win');
      const startBtn  = document.getElementById('ss-start-btn');
      const canvas    = document.getElementById('ss-canvas');
      const freqDisp  = document.getElementById('ss-freq-display');
      const statusDisp= document.getElementById('ss-status-display');
      const msgEl     = document.getElementById('ss-message');
      const holdWrap  = document.getElementById('ss-hold-wrap');
      const holdBar   = document.getElementById('ss-hold-bar');
      const needle    = document.getElementById('ss-tuner-needle');
      const track     = document.getElementById('ss-tuner-track');
      const scopeMv   = document.getElementById('ss-scope-mv');
      const signalPct = document.getElementById('ss-signal-pct');

      if (!canvas || !startBtn) return;
      const ctx = canvas.getContext('2d');
      const bars = [1,2,3,4,5].map(i => document.getElementById('ss-bar-' + i));

      /* ── Smooth pseudo-noise ─────────────────────────────────── */
      function pnoise(x, t) {
        return (
          Math.sin(x * 47.3  + t * 13.7) * 0.35 +
          Math.sin(x * 23.1  + t *  7.3) * 0.28 +
          Math.sin(x * 89.7  + t * 19.1) * 0.22 +
          Math.sin(x * 11.2  + t *  3.1) * 0.15
        );
      }

      /* ── Resize canvas ───────────────────────────────────────── */
      function resizeCanvas() {
        const W = canvas.parentElement ? canvas.parentElement.offsetWidth : 640;
        if (W > 0 && canvas.width !== W) {
          canvas.width  = W;
          canvas.height = 80;
        }
      }

      /* ── Draw oscilloscope ───────────────────────────────────── */
      function drawScope(proximity, t) {
        resizeCanvas();
        const W = canvas.width;
        const H = canvas.height;
        ctx.clearRect(0, 0, W, H);

        // Grid
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgba(0,212,232,0.05)';
        ctx.beginPath();
        ctx.moveTo(0, H / 2); ctx.lineTo(W, H / 2); ctx.stroke();
        for (let i = 1; i < 4; i++) {
          ctx.beginPath();
          ctx.moveTo(W * i / 4, 0); ctx.lineTo(W * i / 4, H); ctx.stroke();
        }

        const noiseScale  = (1 - proximity) * 26;
        const signalScale = proximity * 18;

        if (proximity > 0.4) {
          ctx.shadowColor = 'rgba(0,212,232,' + (proximity * 0.55) + ')';
          ctx.shadowBlur  = proximity * 10;
        } else {
          ctx.shadowBlur = 0;
        }

        const alpha = 0.35 + proximity * 0.65;
        const g = Math.floor(120 + proximity * 92);
        const b = Math.floor(140 + proximity * 88);
        ctx.strokeStyle = 'rgba(0,' + g + ',' + b + ',' + alpha + ')';
        ctx.lineWidth   = 1 + proximity * 0.6;

        ctx.beginPath();
        for (let x = 0; x <= W; x++) {
          const fx     = x / W;
          const signal = Math.sin(fx * Math.PI * 10 + t * 3.0) * signalScale;
          const noise  = pnoise(fx * 6, t) * noiseScale;
          const y      = H / 2 + signal + noise;
          x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.shadowBlur = 0;
      }

      /* ── Proximity 0–1 ──────────────────────────────────────── */
      function getProximity() {
        const dist = Math.abs(currentPos - targetPos);
        return Math.max(0, 1 - dist / 0.16);
      }

      /* ── Update freq readout ─────────────────────────────────── */
      function updateFreq() {
        const hz = FREQ_MIN + currentPos * (FREQ_MAX - FREQ_MIN);
        freqDisp.textContent = hz.toFixed(1) + ' MHz';
        if (track) track.setAttribute('aria-valuenow', Math.round(currentPos * 100));
      }

      /* ── Update signal bars ──────────────────────────────────── */
      function updateBars(prx) {
        const lit = Math.round(prx * 5);
        bars.forEach((b, i) => b && b.classList.toggle('active', i < lit));
        if (signalPct) {
          signalPct.textContent = Math.round(prx * 100) + '%';
          signalPct.style.color = prx > 0.75 ? '#00d4e8' : '';
        }
        if (scopeMv) {
          const mv = Math.round(prx * 460 + pnoise(currentPos * 3, performance.now() / 800) * 18);
          scopeMv.textContent = '~' + Math.max(0, mv) + 'mV';
        }
      }

      /* ── Update status labels ────────────────────────────────── */
      function updateStatus(prx) {
        let status, msg, cls = '';
        if (prx < 0.18) {
          status = 'SCANNING';
          msg    = '> NO SIGNAL — ADJUST FREQUENCY';
        } else if (prx < 0.45) {
          status = 'INTERFERENCE';
          msg    = '> WEAK SIGNAL — CONTINUE TUNING';
        } else if (prx < 0.78) {
          status = 'ACQUIRING';
          msg    = '> SIGNAL DETECTED — REFINE POSITION';
          cls    = 'acquiring';
        } else if (prx < 0.95) {
          status = 'NEAR LOCK';
          msg    = '> APPROACHING CARRIER WAVE';
          cls    = 'acquiring';
        } else {
          status = 'LOCKED';
          msg    = '> SIGNAL LOCKED — HOLD POSITION';
          cls    = 'locked';
        }
        statusDisp.textContent = status;
        statusDisp.className   = cls;
        msgEl.textContent      = msg;
        msgEl.className        = cls;
        needle.className       = prx > 0.95 ? 'locked' : '';
      }

      /* ── Main animation loop ─────────────────────────────────── */
      function tick() {
        if (phase !== 'scanning') return;
        const t   = (performance.now() - timeOrigin) / 1000;
        const prx = getProximity();
        drawScope(prx, t);
        updateFreq();
        updateBars(prx);
        updateStatus(prx);

        const inLock = Math.abs(currentPos - targetPos) <= LOCK_ZONE;
        if (inLock) {
          if (!holdStart) {
            holdStart = performance.now();
            holdWrap.style.display = 'block';
          }
          const elapsed = performance.now() - holdStart;
          const pct = Math.min(100, (elapsed / HOLD_MS) * 100);
          holdBar.style.width = pct + '%';
          if (elapsed >= HOLD_MS) { triggerWin(); return; }
        } else {
          holdStart = null;
          holdWrap.style.display = 'none';
          holdBar.style.width = '0%';
        }

        animFrame = requestAnimationFrame(tick);
      }

      /* ── Set needle from pointer ─────────────────────────────── */
      function setPos(e) {
        const rect = track.getBoundingClientRect();
        const cx   = e.touches ? e.touches[0].clientX : e.clientX;
        currentPos = Math.max(0, Math.min(1, (cx - rect.left) / rect.width));
        needle.style.left = (currentPos * 100) + '%';
      }

      /* ── Wire tuner drag ─────────────────────────────────────── */
      function wireTuner() {
        track.addEventListener('mousedown', e => { dragging = true; setPos(e); });
        track.addEventListener('touchstart', e => { e.preventDefault(); dragging = true; setPos(e); }, { passive: false });
        document.addEventListener('mousemove',  e => { if (dragging) setPos(e); });
        document.addEventListener('touchmove',  e => { if (dragging) { e.preventDefault(); setPos(e); } }, { passive: false });
        document.addEventListener('mouseup',  () => { dragging = false; });
        document.addEventListener('touchend', () => { dragging = false; });
      }

      /* ── Start ───────────────────────────────────────────────── */
      function startGame() {
        targetPos  = 0.1 + Math.random() * 0.8;
        currentPos = 0.5;
        holdStart  = null;
        phase      = 'scanning';
        timeOrigin = performance.now();

        needle.style.left      = '50%';
        needle.className       = '';
        holdWrap.style.display = 'none';
        holdBar.style.width    = '0%';

        introEl.style.display  = 'none';
        winEl.style.display    = 'none';
        gameEl.style.display   = 'block';

        wireTuner();
        animFrame = requestAnimationFrame(tick);
      }

      /* ── Win ─────────────────────────────────────────────────── */
      function triggerWin() {
        phase = 'win';
        cancelAnimationFrame(animFrame);
        drawScope(1, (performance.now() - timeOrigin) / 1000);

        gameEl.style.display = 'none';
        winEl.style.display  = 'block';
        winEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

        if (!playerWired) {
          playerWired = true;
          const audio = document.getElementById('player-cold');
          const btn   = document.getElementById('play-btn-cold');
          const icon  = document.getElementById('play-icon-cold');
          const bar   = document.getElementById('progress-bar-cold');
          const wrap  = document.getElementById('progress-wrap-cold');
          const time  = document.getElementById('time-cold');

          if (audio && btn) {
            audio.dataset.playerId = 'player-cold';
            btn.dataset.audioId    = 'player-cold';

            btn.addEventListener('click', e => {
              e.stopPropagation();
              if (!audio.paused) {
                audio.pause();
                icon.textContent = '▶';
                btn.classList.remove('playing');
              } else {
                stopOthers(audio);
                audio.play()
                  .then(() => { icon.textContent = '■'; btn.classList.add('playing'); })
                  .catch(err => console.warn('[MCenotaph] cold:', err.message));
              }
            });

            if (wrap) {
              wrap.addEventListener('click', e => {
                e.stopPropagation();
                if (!audio.duration) return;
                const rect = wrap.getBoundingClientRect();
                audio.currentTime = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width)) * audio.duration;
              });
              wrap.addEventListener('touchend', e => {
                e.preventDefault();
                if (!audio.duration) return;
                const rect = wrap.getBoundingClientRect();
                audio.currentTime = Math.max(0, Math.min(1, (e.changedTouches[0].clientX - rect.left) / rect.width)) * audio.duration;
              });
            }

            audio.addEventListener('timeupdate', () => {
              if (!audio.duration) return;
              if (bar)  bar.style.width = (audio.currentTime / audio.duration * 100) + '%';
              if (time) time.textContent = fmt(audio.currentTime) + ' / ' + fmt(audio.duration);
            });
            audio.addEventListener('ended', () => {
              icon.textContent = '▶';
              btn.classList.remove('playing');
              if (bar)  bar.style.width = '0%';
              if (time) time.textContent = '00:00';
            });
          }
        }

        // Update SYS panel
        if (typeof SYS !== 'undefined' && typeof updateSysStatus === 'function') {
          SYS.unlockedFiles = (SYS.unlockedFiles || 0) + 1;
          updateSysStatus();
        }
      }

      startBtn.addEventListener('click', startGame);

    })(); // end signal scan IIFE

    /* ============================================================
       CURSOR TRAIL — glitch sparks
    ============================================================ */
    (function() {
      let lastX = 0, lastY = 0, lastTime = 0;
      const COLORS_NORMAL = ['rgba(160,160,255,0.6)', 'rgba(180,180,255,0.4)', 'rgba(200,200,255,0.3)'];
      const COLORS_GOLD   = ['rgba(255,200,40,0.65)',  'rgba(255,160,20,0.45)', 'rgba(255,220,80,0.3)'];

      document.addEventListener('mousemove', e => {
        const now = Date.now();
        if (now - lastTime < 32) return; // ~30 fps cap
        lastTime = now;

        const dx = e.clientX - lastX;
        const dy = e.clientY - lastY;
        const speed = Math.sqrt(dx*dx + dy*dy);
        if (speed < 6) return;

        lastX = e.clientX;
        lastY = e.clientY;

        const gold   = document.body.classList.contains('gold-mode');
        const colors = gold ? COLORS_GOLD : COLORS_NORMAL;
        const count  = Math.min(3, Math.floor(speed / 18) + 1);

        for (let i = 0; i < count; i++) {
          const spark = document.createElement('div');
          spark.className = 'cursor-spark';
          const size = 2 + Math.random() * 3;
          spark.style.cssText = `
            left: ${e.clientX + (Math.random()-0.5)*12}px;
            top:  ${e.clientY + (Math.random()-0.5)*12}px;
            width: ${size}px; height: ${size}px;
            background: ${colors[Math.floor(Math.random()*colors.length)]};
          `;
          document.body.appendChild(spark);
          setTimeout(() => spark.remove(), 560);
        }
      });
    })();

    /* ============================================================
       TAB TITLE — unauthorized absence detector
    ============================================================ */
    (function() {
      const original = document.title;
      const warnings = [
        '⚠ UNAUTHORIZED ABSENCE DETECTED',
        '// ARCHIVE AWAITS YOUR RETURN',
        '> SESSION STILL ACTIVE...',
        '⚠ DO NOT LEAVE THE ARCHIVE',
      ];
      let idx = 0, interval = null;

      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          interval = setInterval(() => {
            document.title = warnings[idx % warnings.length];
            idx++;
          }, 2200);
        } else {
          clearInterval(interval);
          document.title = original;
          idx = 0;
        }
      });
    })();

    /* ============================================================
       CONSOLE SECRET MESSAGE
    ============================================================ */
    (function() {
      const css = (c, s) => [c, `color:${s};font-family:monospace;font-size:11px;`];
      console.log(...css('%c\n  ███╗   ███╗ ██████╗███████╗███╗  ██╗\n  ████╗ ████║██╔════╝██╔════╝████╗ ██║\n  ██╔████╔██║██║     █████╗  ██╔██╗██║\n  ██║╚██╔╝██║██║     ██╔══╝  ██║╚████║\n  ██║ ╚═╝ ██║╚██████╗███████╗██║ ╚███║\n  ╚═╝     ╚═╝ ╚═════╝╚══════╝╚═╝  ╚══╝\n                                       ', '#9898c0'));
      console.log(...css('%c  M. CENOTAPH — DIGITAL NECROPOLIS', '#c8c8ff'));
      console.log(...css('%c  ─────────────────────────────────────────────', '#26263a'));
      console.log(...css('%c  You found the back channel. Impressive.', '#7878a0'));
      console.log(...css('%c  ─────────────────────────────────────────────', '#26263a'));
      console.log(...css('%c  HINT: The condition the music was composed inside.', '#9a7840'));
      console.log(...css('%c  HINT: Listen for what the body does after death.', '#9a7840'));
      console.log(...css('%c  ─────────────────────────────────────────────', '#26263a'));
      console.log(...css('%c  Access Level: CONDITIONAL\n  Session is being monitored.\n', '#58587a'));
    })();

    /* ============================================================
       GLASS TEARS — STATIC WEEP MINIGAME
    ============================================================ */
    (function() {
      'use strict';

      const TARGET     = 15;    // tears to catch
      const MAX_LIVES  = 3;
      const BASE_SPAWN = 1600;  // ms between tear spawns initially
      const MIN_SPAWN  = 640;   // fastest spawn rate

      let lives     = MAX_LIVES;
      let caught    = 0;
      let wave      = 1;
      let phase     = 'idle';
      let tears     = [];       // active tear objects
      let fakes     = [];       // active static burst objects
      let spawnTimer = null;
      let animFrame  = null;
      let playerWired = false;

      // DOM
      const introEl   = document.getElementById('gt-intro');
      const gameEl    = document.getElementById('gt-game');
      const winEl     = document.getElementById('gt-win');
      const failEl    = document.getElementById('gt-fail');
      const canvas    = document.getElementById('gt-canvas');
      const msgEl     = document.getElementById('gt-message');
      const counterEl = document.getElementById('gt-counter');
      const waveEl    = document.getElementById('gt-wave-num');
      const startBtn  = document.getElementById('gt-start-btn');
      const retryBtn  = document.getElementById('gt-retry-btn');

      if (!canvas || !startBtn) return;
      const ctx = canvas.getContext('2d');

      function lifeEl(i) { return document.getElementById('gt-life-' + i); }

      /* ── Resize canvas ───────────────────────────────────────── */
      function resizeCanvas() {
        const W = canvas.parentElement ? canvas.parentElement.offsetWidth : 760;
        if (W > 0 && canvas.width !== W) canvas.width = W;
      }

      /* ── Spawn a real tear ───────────────────────────────────── */
      function spawnTear() {
        if (phase !== 'playing') return;
        resizeCanvas();
        const W = canvas.width;
        const H = canvas.height;
        const x = 12 + Math.random() * (W - 24);
        const speed = 0.6 + Math.random() * 0.9 + (wave - 1) * 0.15;
        const height = 18 + Math.random() * 30;
        const alpha = 0.55 + Math.random() * 0.45;

        tears.push({ x, y: -height, speed, height, alpha, clicked: false, flash: 0 });

        // Also sometimes spawn a fake (static burst) — more often in later waves
        if (Math.random() < 0.25 + wave * 0.06) spawnFake();

        const spawnMs = Math.max(MIN_SPAWN, BASE_SPAWN - (wave - 1) * 150);
        spawnTimer = setTimeout(spawnTear, spawnMs * (0.7 + Math.random() * 0.6));
      }

      /* ── Spawn a fake (red static burst) ────────────────────── */
      function spawnFake() {
        resizeCanvas();
        const W = canvas.width;
        const x = 12 + Math.random() * (W - 24);
        const lifeMs = 600 + Math.random() * 700;
        fakes.push({ x, y: 8 + Math.random() * (canvas.height - 24), lifeMs, born: performance.now(), r: 10 + Math.random() * 12, clicked: false });
      }

      /* ── Click handling on canvas ────────────────────────────── */
      canvas.addEventListener('click', handleClick);
      canvas.addEventListener('touchend', e => { e.preventDefault(); handleClick(e.changedTouches[0]); });

      function handleClick(e) {
        if (phase !== 'playing') return;
        const rect  = canvas.getBoundingClientRect();
        const scaleX = canvas.width  / rect.width;
        const scaleY = canvas.height / rect.height;
        const cx = (e.clientX - rect.left) * scaleX;
        const cy = (e.clientY - rect.top)  * scaleY;

        // Check fakes first (penalty)
        for (const f of fakes) {
          if (f.clicked) continue;
          const dx = cx - f.x, dy = cy - f.y;
          if (Math.sqrt(dx*dx + dy*dy) < f.r + 14) {
            f.clicked = true;
            loseLife();
            return;
          }
        }

        // Check real tears
        const HIT_PAD = 14;
        for (const t of tears) {
          if (t.clicked) continue;
          if (cx > t.x - HIT_PAD && cx < t.x + HIT_PAD &&
              cy > t.y - HIT_PAD && cy < t.y + t.height + HIT_PAD) {
            t.clicked = true;
            t.flash   = 8;
            caught++;
            counterEl.textContent = String(caught).padStart(2,'0') + ' / ' + TARGET;
            setMsg('> FRAGMENT CAPTURED', 'hit');
            setTimeout(() => { if (phase === 'playing') setMsg('▸ TEARS INCOMING — INTERCEPT NOW', ''); }, 800);

            // Wave up every 5 caught
            if (caught % 5 === 0 && caught < TARGET) {
              wave++;
              waveEl.textContent = String(wave).padStart(2,'0');
              setMsg('> WAVE ' + wave + ' — SIGNAL INTENSIFYING', 'warn');
            }

            if (caught >= TARGET) { triggerWin(); return; }
            return;
          }
        }
      }

      /* ── Lose a life ─────────────────────────────────────────── */
      function loseLife() {
        lives--;
        const el = lifeEl(lives + 1);
        if (el) el.classList.add('lost');
        setMsg('> STATIC INTERFERENCE — SIGNAL CORRUPTED', 'miss');

        // Brief glitch flash
        canvas.style.filter = 'invert(0.15) hue-rotate(30deg)';
        setTimeout(() => { canvas.style.filter = ''; }, 120);

        setTimeout(() => {
          if (phase === 'playing') setMsg('▸ TEARS INCOMING — INTERCEPT NOW', '');
        }, 900);

        if (lives <= 0) { setTimeout(triggerFail, 600); }
      }

      /* ── Set message ─────────────────────────────────────────── */
      function setMsg(text, cls) {
        msgEl.textContent = text;
        msgEl.className   = cls || '';
      }

      /* ── Draw frame ──────────────────────────────────────────── */
      function draw() {
        animFrame = requestAnimationFrame(draw);
        if (phase !== 'playing') return;

        resizeCanvas();
        const W = canvas.width;
        const H = canvas.height;
        ctx.clearRect(0, 0, W, H);

        const now = performance.now();

        // ── Draw fakes (red static burst) ──────────────────────
        for (let i = fakes.length - 1; i >= 0; i--) {
          const f    = fakes[i];
          const age  = now - f.born;
          const prog = age / f.lifeMs;
          if (prog >= 1 || f.clicked) { fakes.splice(i, 1); continue; }

          const a = f.clicked ? 0 : Math.sin(prog * Math.PI) * 0.85;
          const pulseR = f.r * (0.8 + 0.3 * Math.sin(now / 60));

          ctx.beginPath();
          ctx.arc(f.x, f.y, pulseR, 0, Math.PI * 2);
          ctx.fillStyle   = `rgba(255, 40, 40, ${a * 0.15})`;
          ctx.fill();

          ctx.beginPath();
          ctx.arc(f.x, f.y, pulseR * 0.5, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(255, 80, 80, ${a * 0.6})`;
          ctx.shadowColor = `rgba(255, 40, 40, ${a})`;
          ctx.shadowBlur  = 14;
          ctx.fill();
          ctx.shadowBlur = 0;

          // Static spikes
          ctx.strokeStyle = `rgba(255,60,60,${a * 0.7})`;
          ctx.lineWidth = 1;
          for (let s = 0; s < 6; s++) {
            const ang   = (s / 6) * Math.PI * 2 + now / 200;
            const sLen  = pulseR + 4 + Math.sin(now / 80 + s) * 5;
            ctx.beginPath();
            ctx.moveTo(f.x + Math.cos(ang) * (pulseR * 0.5), f.y + Math.sin(ang) * (pulseR * 0.5));
            ctx.lineTo(f.x + Math.cos(ang) * sLen,           f.y + Math.sin(ang) * sLen);
            ctx.stroke();
          }
        }

        // ── Draw real tears ─────────────────────────────────────
        for (let i = tears.length - 1; i >= 0; i--) {
          const t = tears[i];
          if (t.clicked && t.flash <= 0) { tears.splice(i, 1); continue; }

          if (!t.clicked) {
            t.y += t.speed;
            // Slight horizontal drift
            t.x += Math.sin(now / 700 + i) * 0.12;
          }

          if (t.y > canvas.height + t.height) { tears.splice(i, 1); continue; }

          if (t.flash > 0) {
            t.flash--;
            // Flash white on capture
            ctx.globalAlpha = t.flash / 8;
            const gFlash = ctx.createLinearGradient(t.x, t.y, t.x, t.y + t.height);
            gFlash.addColorStop(0, 'rgba(255,255,255,0)');
            gFlash.addColorStop(0.5, 'rgba(200,230,255,1)');
            gFlash.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.strokeStyle = gFlash;
            ctx.lineWidth   = 3;
            ctx.shadowColor = '#ffffff';
            ctx.shadowBlur  = 20;
            ctx.beginPath();
            ctx.moveTo(t.x, t.y);
            ctx.lineTo(t.x, t.y + t.height);
            ctx.stroke();
            ctx.globalAlpha = 1;
            ctx.shadowBlur  = 0;
            continue;
          }

          // Normal tear — blue/white gradient
          const fadeNear = t.y < 20 ? t.y / 20 : 1;
          const fadeFar  = t.y + t.height > canvas.height - 30
            ? Math.max(0, 1 - (t.y + t.height - (canvas.height - 30)) / 30) : 1;
          const alpha = t.alpha * fadeNear * fadeFar;

          const g = ctx.createLinearGradient(t.x, t.y, t.x, t.y + t.height);
          g.addColorStop(0,   `rgba(150, 200, 255, 0)`);
          g.addColorStop(0.2, `rgba(168, 216, 255, ${alpha * 0.6})`);
          g.addColorStop(0.55,`rgba(200, 230, 255, ${alpha})`);
          g.addColorStop(0.8, `rgba(168, 216, 255, ${alpha * 0.5})`);
          g.addColorStop(1,   `rgba(100, 160, 255, 0)`);

          ctx.strokeStyle = g;
          ctx.lineWidth   = 1.5 + alpha * 0.8;
          ctx.shadowColor = `rgba(160, 210, 255, ${alpha * 0.55})`;
          ctx.shadowBlur  = 8 + alpha * 6;
          ctx.lineCap     = 'round';

          ctx.beginPath();
          ctx.moveTo(t.x, t.y);
          ctx.lineTo(t.x, t.y + t.height);
          ctx.stroke();
          ctx.shadowBlur = 0;
        }
      }

      /* ── Win ─────────────────────────────────────────────────── */
      function triggerWin() {
        phase = 'win';
        clearTimeout(spawnTimer);
        gameEl.style.display = 'none';
        winEl.style.display  = 'block';
        winEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

        if (!playerWired) {
          playerWired = true;
          const audio = document.getElementById('player-glass');
          const btn   = document.getElementById('play-btn-glass');
          const icon  = document.getElementById('play-icon-glass');
          const bar   = document.getElementById('progress-bar-glass');
          const wrap  = document.getElementById('progress-wrap-glass');
          const time  = document.getElementById('time-glass');

          if (audio && btn) {
            audio.dataset.playerId = 'player-glass';
            btn.dataset.audioId    = 'player-glass';

            btn.addEventListener('click', e => {
              e.stopPropagation();
              if (!audio.paused) {
                audio.pause(); icon.textContent = '▶'; btn.classList.remove('playing');
              } else {
                stopOthers(audio);
                audio.play()
                  .then(() => { icon.textContent = '■'; btn.classList.add('playing'); })
                  .catch(err => console.warn('[MCenotaph] glass:', err.message));
              }
            });
            if (wrap) {
              wrap.addEventListener('click', e => {
                e.stopPropagation();
                if (!audio.duration) return;
                const rect = wrap.getBoundingClientRect();
                audio.currentTime = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width)) * audio.duration;
              });
            }
            audio.addEventListener('timeupdate', () => {
              if (!audio.duration) return;
              if (bar)  bar.style.width = (audio.currentTime / audio.duration * 100) + '%';
              if (time) time.textContent = fmt(audio.currentTime) + ' / ' + fmt(audio.duration);
            });
            audio.addEventListener('ended', () => {
              icon.textContent = '▶'; btn.classList.remove('playing');
              if (bar) bar.style.width = '0%';
              if (time) time.textContent = '00:00';
            });
          }
        }

        if (typeof SYS !== 'undefined' && typeof updateSysStatus === 'function') {
          SYS.unlockedFiles = (SYS.unlockedFiles || 0) + 1;
          updateSysStatus();
        }
      }

      /* ── Fail ────────────────────────────────────────────────── */
      function triggerFail() {
        phase = 'fail';
        clearTimeout(spawnTimer);
        gameEl.style.display = 'none';
        failEl.style.display = 'block';
      }

      /* ── Start / Restart ─────────────────────────────────────── */
      function startGame() {
        lives  = MAX_LIVES;
        caught = 0;
        wave   = 1;
        tears  = [];
        fakes  = [];
        phase  = 'playing';

        [1,2,3].forEach(i => { const el = lifeEl(i); if (el) el.classList.remove('lost'); });
        counterEl.textContent = '00 / ' + TARGET;
        waveEl.textContent    = '01';

        introEl.style.display = 'none';
        failEl.style.display  = 'none';
        winEl.style.display   = 'none';
        gameEl.style.display  = 'block';

        setMsg('▸ TEARS INCOMING — INTERCEPT NOW', '');
        clearTimeout(spawnTimer);
        spawnTimer = setTimeout(spawnTear, 800);

        if (!animFrame) draw();
      }

      startBtn.addEventListener('click',  startGame);
      retryBtn.addEventListener('click',  startGame);

    })(); // end glass tears IIFE

    /* ============================================================
       MORSE CODE — hidden signal in the dot
       Message: "ALL PERISH — DOES HASTE ALTER THE END"
       (omnia peribunt — ha senso avere fretta?)
    ============================================================ */
    (function() {
      const dot = document.getElementById('morse-dot');
      if (!dot) return;

      // Timing (ms) — deliberate, readable pace
      const DIT  = 200;   // dot duration
      const DAH  = 600;   // dash duration
      const SYM  = 200;   // gap between symbols within a letter
      const LET  = 600;   // gap between letters
      const WRD  = 1400;  // gap between words
      const PAUSE = 5000; // silence at end of message before repeat

      // Morse alphabet
      const ALPHA = {
        A:'.-',  B:'-...', C:'-.-.', D:'-..',  E:'.',   F:'..-.',
        G:'--.',  H:'....', I:'..',   J:'.---', K:'-.-', L:'.-..',
        M:'--',   N:'-.',   O:'---',  P:'.--.',  Q:'--.-', R:'.-.',
        S:'...',  T:'-',    U:'..-',  V:'...-',  W:'.--',  X:'-..-',
        Y:'-.--', Z:'--..',
        '1':'.----','2':'..---','3':'...--','4':'....-','5':'.....',
        '6':'-....','7':'--...','8':'---..','9':'----.','0':'-----',
      };

      // Message to transmit
      const MSG = 'ALL PERISH DOES HASTE ALTER THE END';

      // Build sequence: array of { on: bool, ms: number }
      function buildSequence(text) {
        const seq = [];
        const words = text.toUpperCase().split(' ');
        words.forEach((word, wi) => {
          [...word].forEach((ch, ci) => {
            const code = ALPHA[ch];
            if (!code) return;
            [...code].forEach((sym, si) => {
              seq.push({ on: true,  ms: sym === '.' ? DIT : DAH });
              if (si < code.length - 1) seq.push({ on: false, ms: SYM });
            });
            if (ci < word.length - 1) seq.push({ on: false, ms: LET });
          });
          if (wi < words.length - 1) seq.push({ on: false, ms: WRD });
        });
        seq.push({ on: false, ms: PAUSE });
        return seq;
      }

      const sequence = buildSequence(MSG);
      let idx = 0;

      function step() {
        const { on, ms } = sequence[idx];
        dot.classList.toggle('on', on);
        idx = (idx + 1) % sequence.length;
        setTimeout(step, ms);
      }

      // Start after a short delay so page load doesn't interfere
      setTimeout(step, 3200);

      // Tooltip hint for die-hard explorers who hover the dot
      dot.addEventListener('mouseenter', () => {
        dot.title = '... .. --. -. .- .-.'; // SIGNAL in morse
      });
    })();

    /* ============================================================
       AUDIO VISUALIZER
       Injects a canvas bar-graph into every .player-ui.
       Hooks into Web Audio API — activates on play, fades on pause.
    ============================================================ */
    (function() {
      let audioCtx = null;
      const analysers = new Map();

      function getCtx() {
        if (!audioCtx) {
          try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
          catch(e) { return null; }
        }
        return audioCtx;
      }

      function findVizCanvas(audioEl) {
        let el = audioEl.parentElement;
        for (let i = 0; i < 6 && el; i++) {
          const vc = el.querySelector('.viz-canvas');
          if (vc) return vc;
          el = el.parentElement;
        }
        return null;
      }

      function ensureAnalyser(audioEl) {
        if (analysers.has(audioEl)) return analysers.get(audioEl);
        const ctx2 = getCtx();
        if (!ctx2) return null;
        try {
          const src = ctx2.createMediaElementSource(audioEl);
          const an  = ctx2.createAnalyser();
          an.fftSize = 128;
          an.smoothingTimeConstant = 0.8;
          src.connect(an);
          an.connect(ctx2.destination);
          const entry = { analyser: an, canvas: findVizCanvas(audioEl), raf: null };
          analysers.set(audioEl, entry);
          return entry;
        } catch(e) { return null; }
      }

      function startViz(audioEl) {
        const ac = getCtx();
        if (ac && ac.state === 'suspended') ac.resume().catch(() => {});
        const entry = ensureAnalyser(audioEl);
        if (!entry) return;
        if (!entry.canvas) entry.canvas = findVizCanvas(audioEl);
        const vc = entry.canvas;
        if (!vc) return;

        vc.width  = vc.offsetWidth  || 300;
        vc.height = vc.offsetHeight || 36;
        vc.classList.add('active');

        const c    = vc.getContext('2d');
        const data = new Uint8Array(entry.analyser.frequencyBinCount);

        function frame() {
          entry.raf = requestAnimationFrame(frame);
          const W = vc.width, H = vc.height;
          entry.analyser.getByteFrequencyData(data);
          c.clearRect(0, 0, W, H);
          const gold = document.body.classList.contains('gold-mode');
          const bars = data.length;
          const bw   = W / bars;
          for (let i = 0; i < bars; i++) {
            const v  = data[i] / 255;
            const bh = Math.max(1, v * H * 0.9);
            const x  = i * bw;
            let r, g, b;
            if (gold) {
              r = 180 + Math.floor(v * 75);
              g = 110 + Math.floor(v * 100);
              b = 8   + Math.floor(v * 18);
            } else {
              r = 90  + Math.floor(v * 70);
              g = 90  + Math.floor(v * 70);
              b = 200 + Math.floor(v * 55);
            }
            c.fillStyle = `rgba(${r},${g},${b},${0.22 + v * 0.78})`;
            c.fillRect(x + 0.5, H - bh, Math.max(0.5, bw - 1), bh);
            if (v > 0.7) {
              c.fillStyle = gold
                ? `rgba(255,245,120,${(v - 0.7) * 2.8})`
                : `rgba(210,210,255,${(v - 0.7) * 2.8})`;
              c.fillRect(x + 0.5, H - bh, Math.max(0.5, bw - 1), 1);
            }
          }
        }
        frame();
      }

      function stopViz(audioEl) {
        const entry = analysers.get(audioEl);
        if (!entry) return;
        cancelAnimationFrame(entry.raf);
        entry.raf = null;
        if (entry.canvas) {
          entry.canvas.classList.remove('active');
          entry.canvas.getContext('2d').clearRect(0, 0, entry.canvas.width, entry.canvas.height);
        }
      }

      // Inject viz canvas into every .player-ui (including future ones)
      function injectCanvases() {
        document.querySelectorAll('.player-ui').forEach(ui => {
          if (!ui.querySelector('.viz-canvas')) {
            const vc = document.createElement('canvas');
            vc.className = 'viz-canvas';
            vc.setAttribute('aria-hidden', 'true');
            vc.height = 36;
            ui.appendChild(vc);
          }
        });
      }
      injectCanvases();
      new MutationObserver(injectCanvases).observe(document.body, { childList: true, subtree: true });

      function hookAudio(audioEl) {
        if (audioEl.dataset.vizHooked) return;
        audioEl.dataset.vizHooked = '1';
        audioEl.addEventListener('play',  () => startViz(audioEl));
        audioEl.addEventListener('pause', () => stopViz(audioEl));
        audioEl.addEventListener('ended', () => stopViz(audioEl));
      }
      document.querySelectorAll('audio').forEach(hookAudio);
      new MutationObserver(muts => {
        muts.forEach(m => m.addedNodes.forEach(n => {
          if (n.tagName === 'AUDIO') hookAudio(n);
          if (n.querySelectorAll) n.querySelectorAll('audio').forEach(hookAudio);
        }));
      }).observe(document.body, { childList: true, subtree: true });

    })(); // end visualizer IIFE

    /* ============================================================
       GHOST TYPER
       3 min idle  → shallow ghost: types lore-plausible wrong codes,
                     moves cursor to SUBMIT, clicks, gets rejected.
       6 min idle  → deep ghost: types real partial vault hints,
                     hesitates, deletes everything, never submits.
    ============================================================ */
    (function() {
      const IDLE_MS      = 3 * 60 * 1000;
      const IDLE_DEEP_MS = 6 * 60 * 1000;

      const cursor   = document.getElementById('ghost-cursor');
      const ring     = document.getElementById('ghost-cursor-ring');
      const vaultInp = document.getElementById('vault-key');
      const vaultBtn = document.getElementById('vault-submit');
      if (!cursor || !ring || !vaultInp || !vaultBtn) return;

      let lastActivity = Date.now();
      let ghostActive  = false;

      ['mousemove','mousedown','keydown','touchstart','scroll','click'].forEach(ev =>
        document.addEventListener(ev, () => {
          lastActivity = Date.now();
          if (ghostActive) abortGhost();
        }, { passive: true })
      );

      const SHALLOW = [
        'MEMORIAM','PETRIFIED','CADAVER','SILENCE',
        'VOID','OBITUS','CORPUS','FRAGMENTED',
        'LACRIMOSA','PALLOR','RIGOR','INERTIA',
        'COMMEND','SOVEREIGN','THERMAL',   // Gold-only teases
      ];
      const DEEP = [
        'ALGOR',     // hints at ALGOR_MORTIS
        'BLUEPRINT', // valid code — ghost always deletes last
        'PHANTOM',   // hints at Ghost Protocol char before submit
        'DECAYING',  // near DECAY
        'ARCHITECT', // near BLUEPRINT lore
      ];

      const sleep = ms => new Promise(r => ghostActive ? setTimeout(r, ms) : r());

      function abortGhost() {
        ghostActive = false;
        cursor.classList.remove('visible');
        ring.classList.remove('visible','clicking');
        if (document.activeElement === vaultInp) vaultInp.blur();
      }

      function moveToEl(el, durationMs) {
        return new Promise(resolve => {
          const rect = el.getBoundingClientRect();
          const tx   = rect.left + rect.width  * 0.5;
          const ty   = rect.top  + rect.height * 0.5;
          const sx   = parseFloat(cursor.style.left) || window.innerWidth  * 0.5;
          const sy   = parseFloat(cursor.style.top)  || window.innerHeight * 0.9;
          const N    = Math.max(24, Math.round(durationMs / 16));
          let   s    = 0;
          const eio  = t => t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;
          function step() {
            if (!ghostActive) return resolve();
            s++;
            const t  = eio(s / N);
            cursor.style.left = ring.style.left = (sx + (tx-sx)*t) + 'px';
            cursor.style.top  = ring.style.top  = (sy + (ty-sy)*t) + 'px';
            s < N ? requestAnimationFrame(step) : resolve();
          }
          requestAnimationFrame(step);
        });
      }

      async function ghostClick() {
        ring.classList.add('clicking');
        await sleep(110);
        ring.classList.remove('clicking');
      }

      async function typeStr(str, baseMs) {
        for (const ch of str) {
          if (!ghostActive) return;
          vaultInp.value += ch;
          await sleep(baseMs * (0.55 + Math.random() * 0.9));
        }
      }

      async function deleteAll(baseMs) {
        while (ghostActive && vaultInp.value.length > 0) {
          vaultInp.value = vaultInp.value.slice(0, -1);
          await sleep(baseMs * (0.6 + Math.random() * 0.8));
        }
      }

      async function runGhost(deep) {
        if (ghostActive) return;
        ghostActive = true;

        // Appear in a corner, invisible at first
        cursor.style.left = ring.style.left = (window.innerWidth  * (0.04 + Math.random()*0.12)) + 'px';
        cursor.style.top  = ring.style.top  = (window.innerHeight * (0.86 + Math.random()*0.1))  + 'px';
        cursor.classList.add('visible');
        ring.classList.add('visible');
        await sleep(600 + Math.random() * 500);

        // Glide to vault input
        await moveToEl(vaultInp, 1500 + Math.random() * 700);
        if (!ghostActive) return;
        await ghostClick();
        vaultInp.focus();
        vaultInp.value = '';
        await sleep(380 + Math.random() * 340);

        const word = (deep ? DEEP : SHALLOW)[Math.floor(Math.random() * (deep ? DEEP : SHALLOW).length)];
        await typeStr(word, deep ? 140 : 88);
        if (!ghostActive) return;

        await sleep(deep ? 1000 : 440);

        if (deep) {
          // Hesitate — delete everything, vanish
          await deleteAll(55);
        } else {
          // Move to submit button, click
          await moveToEl(vaultBtn, 400 + Math.random() * 280);
          await ghostClick();
          vaultBtn.click();
          await sleep(1300);
          await deleteAll(42);
        }
        await sleep(280);

        // Drift off screen
        cursor.style.transition = ring.style.transition =
          'left 1.4s ease-in, top 1.4s ease-in, opacity 0.7s 0.5s ease';
        cursor.style.left = ring.style.left = (window.innerWidth  * Math.random() * 0.2) + 'px';
        cursor.style.top  = ring.style.top  = (window.innerHeight * (0.92 + Math.random()*0.07)) + 'px';
        await sleep(1000);
        cursor.classList.remove('visible');
        ring.classList.remove('visible');
        cursor.style.transition = ring.style.transition = '';
        ghostActive = false;
      }

      setInterval(() => {
        const idle = Date.now() - lastActivity;
        if      (idle >= IDLE_DEEP_MS && !ghostActive) runGhost(true);
        else if (idle >= IDLE_MS      && !ghostActive) runGhost(false);
      }, 30000);

    })(); // end ghost typer IIFE

  </script>
</body>
</html>
